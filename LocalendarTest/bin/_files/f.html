<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://emma.sourceforge.net/">EMMA</A> Coverage Report (generated Sun May 04 22:10:52 HKT 2014)</TH></TR><TR><TD CLASS="nv">[<A HREF="../coverage.html">all classes</A>][<A HREF="1.html">com.facebook.android</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">Facebook.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>Facebook.java</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/68)</TD><TD CLASS="h">0%   (0/1312)</TD><TD CLASS="h">0%   (0/305)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">Facebook</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/55)</TD><TD CLASS="h">0%   (0/1018)</TD><TD CLASS="h">0%   (0/236)</TD></TR><TR><TD CLASS="f"><A HREF="#1">&lt;static initializer&gt;</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/10)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">Facebook (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/27)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#0">access$000 (Facebook, Session, SessionState, Exception, Facebook$DialogListen...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#0">access$100 (Facebook): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#0">access$102 (Facebook, String): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#0">access$200 (Facebook): Session</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#0">access$400 (Facebook): long</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#0">access$402 (Facebook, long): long</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#0">access$500 (Facebook): String []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#0">access$502 (Facebook, String []): String []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#0">access$600 (String []): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#0">access$700 (Facebook): long</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#0">access$702 (Facebook, long): long</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#0">access$800 (List): String []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#f">authorize (Activity, Facebook$DialogListener): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">authorize (Activity, String [], Facebook$DialogListener): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#11">authorize (Activity, String [], int, Facebook$DialogListener): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/14)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">authorize (Activity, String [], int, SessionLoginBehavior, Facebook$DialogLis...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/61)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#13">authorizeCallback (int, int, Intent): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">checkUserSession (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/16)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#15">dialog (Context, String, Bundle, Facebook$DialogListener): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/53)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">dialog (Context, String, Facebook$DialogListener): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#17">extendAccessToken (Context, Facebook$ServiceListener): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/30)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">extendAccessTokenIfNeeded (Context, Facebook$ServiceListener): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/13)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#19">getAccessExpires (): long</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">getAccessToken (): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/10)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">getAppId (): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">getAttributionId (ContentResolver): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">getLastAccessUpdate (): long</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">getSession (): Session</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/142)</TD><TD CLASS="h">0%   (0/35)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">getShouldAutoPublishInstall (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">getTokenCache (): TokenCachingStrategy</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/13)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#21">isSessionValid (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">logout (Context): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#23">logoutImpl (Context): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/56)</TD><TD CLASS="h">0%   (0/17)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">onSessionCallback (Session, SessionState, Exception, Facebook$DialogListener)...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/89)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="f"><A HREF="#25">openSession (Session, Session$OpenRequest, boolean): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/13)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">publishInstall (Context): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#27">request (Bundle): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#28">request (String): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#29">request (String, Bundle): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">request (String, Bundle, String): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">requestImpl (String, Bundle, String): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/30)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2c">setAccessExpires (long): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">setAccessExpiresIn (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">setAccessToken (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#2f">setAppId (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#30">setSession (Session): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/24)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#31">setShouldAutoPublishInstall (boolean): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#32">setTokenFromCache (String, long, long): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#33">shouldExtendAccessToken (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#34">stringArray (List): String []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/29)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#35">stringList (String []): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#36">validateAppSignatureForPackage (Context, String): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/36)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#37">validateServiceIntent (Context, Intent): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#38">Facebook$1</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/18)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#38">Facebook$1 (Facebook, Facebook$DialogListener): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3a">call (Session, SessionState, Exception): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#3b">Facebook$SetterTokenCachingStrategy</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/76)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR><TD CLASS="f"><A HREF="#3b">Facebook$SetterTokenCachingStrategy (Facebook): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3b">Facebook$SetterTokenCachingStrategy (Facebook, Facebook$1): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#3e">clear (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3f">load (): Bundle</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/34)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#40">save (Bundle): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#41">Facebook$TokenRefreshConnectionHandler</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/120)</TD><TD CLASS="h">0%   (0/29)</TD></TR><TR><TD CLASS="f"><A HREF="#41">Facebook$TokenRefreshConnectionHandler (Facebook, Facebook$TokenRefreshServic...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#43">handleMessage (Message): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/105)</TD><TD CLASS="h">0%   (0/25)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#44">Facebook$TokenRefreshServiceConnection</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/80)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="f"><A HREF="#44">Facebook$TokenRefreshServiceConnection (Facebook, Context, Facebook$ServiceLi...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#46">onServiceConnected (ComponentName, IBinder): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#47">onServiceDisconnected (ComponentName): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#48">refreshToken (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/33)</TD><TD CLASS="h">0%   (0/10)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="l">1</TD><TD>/**</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright 2010-present Facebook</TD></TR><TR><TD CLASS="l">3</TD><TD> *</TD></TR><TR><TD CLASS="l">4</TD><TD> * Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);</TD></TR><TR><TD CLASS="l">5</TD><TD> * you may not use this file except in compliance with the License.</TD></TR><TR><TD CLASS="l">6</TD><TD> * You may obtain a copy of the License at</TD></TR><TR><TD CLASS="l">7</TD><TD> *</TD></TR><TR><TD CLASS="l">8</TD><TD> *    http://www.apache.org/licenses/LICENSE-2.0</TD></TR><TR><TD CLASS="l">9</TD><TD> *</TD></TR><TR><TD CLASS="l">10</TD><TD> * Unless required by applicable law or agreed to in writing, software</TD></TR><TR><TD CLASS="l">11</TD><TD> * distributed under the License is distributed on an &#34;AS IS&#34; BASIS,</TD></TR><TR><TD CLASS="l">12</TD><TD> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</TD></TR><TR><TD CLASS="l">13</TD><TD> * See the License for the specific language governing permissions and</TD></TR><TR><TD CLASS="l">14</TD><TD> * limitations under the License.</TD></TR><TR><TD CLASS="l">15</TD><TD> */</TD></TR><TR><TD CLASS="l">16</TD><TD> </TD></TR><TR><TD CLASS="l">17</TD><TD>package com.facebook.android;</TD></TR><TR><TD CLASS="l">18</TD><TD> </TD></TR><TR><TD CLASS="l">19</TD><TD>import android.Manifest;</TD></TR><TR><TD CLASS="l">20</TD><TD>import android.app.Activity;</TD></TR><TR><TD CLASS="l">21</TD><TD>import android.content.*;</TD></TR><TR><TD CLASS="l">22</TD><TD>import android.content.pm.PackageInfo;</TD></TR><TR><TD CLASS="l">23</TD><TD>import android.content.pm.PackageManager;</TD></TR><TR><TD CLASS="l">24</TD><TD>import android.content.pm.PackageManager.NameNotFoundException;</TD></TR><TR><TD CLASS="l">25</TD><TD>import android.content.pm.ResolveInfo;</TD></TR><TR><TD CLASS="l">26</TD><TD>import android.content.pm.Signature;</TD></TR><TR><TD CLASS="l">27</TD><TD>import android.net.Uri;</TD></TR><TR><TD CLASS="l">28</TD><TD>import android.os.*;</TD></TR><TR><TD CLASS="l">29</TD><TD>import com.facebook.*;</TD></TR><TR><TD CLASS="l">30</TD><TD>import com.facebook.Session.StatusCallback;</TD></TR><TR><TD CLASS="l">31</TD><TD> </TD></TR><TR><TD CLASS="l">32</TD><TD>import java.io.FileNotFoundException;</TD></TR><TR><TD CLASS="l">33</TD><TD>import java.io.IOException;</TD></TR><TR><TD CLASS="l">34</TD><TD>import java.lang.ref.WeakReference;</TD></TR><TR><TD CLASS="l">35</TD><TD>import java.net.MalformedURLException;</TD></TR><TR><TD CLASS="l">36</TD><TD>import java.util.Arrays;</TD></TR><TR><TD CLASS="l">37</TD><TD>import java.util.Collections;</TD></TR><TR><TD CLASS="l">38</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">39</TD><TD> </TD></TR><TR><TD CLASS="l">40</TD><TD>/**</TD></TR><TR><TD CLASS="l">41</TD><TD> * THIS CLASS SHOULD BE CONSIDERED DEPRECATED.</TD></TR><TR><TD CLASS="l">42</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">43</TD><TD> * All public members of this class are intentionally deprecated.</TD></TR><TR><TD CLASS="l">44</TD><TD> * New code should instead use</TD></TR><TR><TD CLASS="l">45</TD><TD> * {@link Session} to manage session state,</TD></TR><TR><TD CLASS="l">46</TD><TD> * {@link Request} to make API requests, and</TD></TR><TR><TD CLASS="l">47</TD><TD> * {@link com.facebook.widget.WebDialog} to make dialog requests.</TD></TR><TR><TD CLASS="l">48</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">49</TD><TD> * Adding @Deprecated to this class causes warnings in other deprecated classes</TD></TR><TR><TD CLASS="l">50</TD><TD> * that reference this one.  That is the only reason this entire class is not</TD></TR><TR><TD CLASS="l"><A NAME="0">51</A></TD><TD> * deprecated.</TD></TR><TR><TD CLASS="l">52</TD><TD> *</TD></TR><TR><TD CLASS="l">53</TD><TD> * @devDocDeprecated</TD></TR><TR><TD CLASS="l">54</TD><TD> */</TD></TR><TR CLASS="z"><TD CLASS="l">55</TD><TD>public class Facebook {</TD></TR><TR><TD CLASS="l">56</TD><TD> </TD></TR><TR><TD CLASS="l">57</TD><TD>    // Strings used in the authorization flow</TD></TR><TR><TD CLASS="l">58</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">59</TD><TD>    public static final String REDIRECT_URI = &#34;fbconnect://success&#34;;</TD></TR><TR><TD CLASS="l">60</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">61</TD><TD>    public static final String CANCEL_URI = &#34;fbconnect://cancel&#34;;</TD></TR><TR><TD CLASS="l">62</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">63</TD><TD>    public static final String TOKEN = &#34;access_token&#34;;</TD></TR><TR><TD CLASS="l">64</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">65</TD><TD>    public static final String EXPIRES = &#34;expires_in&#34;;</TD></TR><TR><TD CLASS="l"><A NAME="1">66</A></TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">67</TD><TD>    public static final String SINGLE_SIGN_ON_DISABLED = &#34;service_disabled&#34;;</TD></TR><TR><TD CLASS="l">68</TD><TD> </TD></TR><TR><TD CLASS="l">69</TD><TD>    @Deprecated</TD></TR><TR CLASS="z"><TD CLASS="l">70</TD><TD>    public static final Uri ATTRIBUTION_ID_CONTENT_URI =</TD></TR><TR><TD CLASS="l">71</TD><TD>        Uri.parse(&#34;content://com.facebook.katana.provider.AttributionIdProvider&#34;);</TD></TR><TR><TD CLASS="l">72</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">73</TD><TD>    public static final String ATTRIBUTION_ID_COLUMN_NAME = &#34;aid&#34;;</TD></TR><TR><TD CLASS="l">74</TD><TD> </TD></TR><TR><TD CLASS="l">75</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">76</TD><TD>    public static final int FORCE_DIALOG_AUTH = -1;</TD></TR><TR><TD CLASS="l">77</TD><TD> </TD></TR><TR><TD CLASS="l">78</TD><TD>    private static final String LOGIN = &#34;oauth&#34;;</TD></TR><TR><TD CLASS="l">79</TD><TD> </TD></TR><TR><TD CLASS="l">80</TD><TD>    // Used as default activityCode by authorize(). See authorize() below.</TD></TR><TR><TD CLASS="l">81</TD><TD>    private static final int DEFAULT_AUTH_ACTIVITY_CODE = 32665;</TD></TR><TR><TD CLASS="l">82</TD><TD> </TD></TR><TR><TD CLASS="l">83</TD><TD>    // Facebook server endpoints: may be modified in a subclass for testing</TD></TR><TR><TD CLASS="l">84</TD><TD>    @Deprecated</TD></TR><TR CLASS="z"><TD CLASS="l">85</TD><TD>    protected static String DIALOG_BASE_URL = &#34;https://m.facebook.com/dialog/&#34;;</TD></TR><TR><TD CLASS="l">86</TD><TD>    @Deprecated</TD></TR><TR CLASS="z"><TD CLASS="l">87</TD><TD>    protected static String GRAPH_BASE_URL = &#34;https://graph.facebook.com/&#34;;</TD></TR><TR><TD CLASS="l">88</TD><TD>    @Deprecated</TD></TR><TR CLASS="z"><TD CLASS="l">89</TD><TD>    protected static String RESTSERVER_URL = &#34;https://api.facebook.com/restserver.php&#34;;</TD></TR><TR><TD CLASS="l">90</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">91</TD><TD>    private final Object lock = new Object();</TD></TR><TR><TD CLASS="l">92</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">93</TD><TD>    private String accessToken = null;</TD></TR><TR CLASS="z"><TD CLASS="l">94</TD><TD>    private long accessExpiresMillisecondsAfterEpoch = 0;</TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>    private long lastAccessUpdateMillisecondsAfterEpoch = 0;</TD></TR><TR><TD CLASS="l">96</TD><TD>    private String mAppId;</TD></TR><TR><TD CLASS="l">97</TD><TD> </TD></TR><TR><TD CLASS="l">98</TD><TD>    private Activity pendingAuthorizationActivity;</TD></TR><TR><TD CLASS="l">99</TD><TD>    private String[] pendingAuthorizationPermissions;</TD></TR><TR><TD CLASS="l">100</TD><TD>    private Session pendingOpeningSession;</TD></TR><TR><TD CLASS="l">101</TD><TD> </TD></TR><TR><TD CLASS="l">102</TD><TD>    private volatile Session session; // must synchronize this.sync to write</TD></TR><TR><TD CLASS="l">103</TD><TD>    private boolean sessionInvalidated; // must synchronize this.sync to access</TD></TR><TR><TD CLASS="l">104</TD><TD>    private SetterTokenCachingStrategy tokenCache;</TD></TR><TR><TD CLASS="l">105</TD><TD>    private volatile Session userSetSession;</TD></TR><TR><TD CLASS="l">106</TD><TD> </TD></TR><TR><TD CLASS="l">107</TD><TD>    // If the last time we extended the access token was more than 24 hours ago</TD></TR><TR><TD CLASS="l">108</TD><TD>    // we try to refresh the access token again.</TD></TR><TR><TD CLASS="l">109</TD><TD>    final private static long REFRESH_TOKEN_BARRIER = 24L * 60L * 60L * 1000L;</TD></TR><TR><TD CLASS="l">110</TD><TD> </TD></TR><TR><TD CLASS="l">111</TD><TD>    /**</TD></TR><TR><TD CLASS="l">112</TD><TD>     * Constructor for Facebook object.</TD></TR><TR><TD CLASS="l">113</TD><TD>     * </TD></TR><TR><TD CLASS="l">114</TD><TD>     * @param appId</TD></TR><TR><TD CLASS="l"><A NAME="2">115</A></TD><TD>     *            Your Facebook application ID. Found at</TD></TR><TR><TD CLASS="l">116</TD><TD>     *            www.facebook.com/developers/apps.php.</TD></TR><TR><TD CLASS="l">117</TD><TD>     */</TD></TR><TR><TD CLASS="l">118</TD><TD>    @Deprecated</TD></TR><TR CLASS="z"><TD CLASS="l">119</TD><TD>    public Facebook(String appId) {</TD></TR><TR CLASS="z"><TD CLASS="l">120</TD><TD>        if (appId == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">121</TD><TD>            throw new IllegalArgumentException(&#34;You must specify your application ID when instantiating &#34;</TD></TR><TR><TD CLASS="l">122</TD><TD>                    + &#34;a Facebook object. See README for details.&#34;);</TD></TR><TR><TD CLASS="l">123</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>        mAppId = appId;</TD></TR><TR CLASS="z"><TD CLASS="l">125</TD><TD>    }</TD></TR><TR><TD CLASS="l">126</TD><TD> </TD></TR><TR><TD CLASS="l">127</TD><TD>    /**</TD></TR><TR><TD CLASS="l">128</TD><TD>     * Default authorize method. Grants only basic permissions.</TD></TR><TR><TD CLASS="l">129</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">130</TD><TD>     * See authorize() below for @params.</TD></TR><TR><TD CLASS="l">131</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l"><A NAME="f">132</A></TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">133</TD><TD>     */</TD></TR><TR><TD CLASS="l">134</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">135</TD><TD>    public void authorize(Activity activity, final DialogListener listener) {</TD></TR><TR CLASS="z"><TD CLASS="l">136</TD><TD>        authorize(activity, new String[]{}, DEFAULT_AUTH_ACTIVITY_CODE, SessionLoginBehavior.SSO_WITH_FALLBACK,</TD></TR><TR><TD CLASS="l">137</TD><TD>                listener);</TD></TR><TR CLASS="z"><TD CLASS="l">138</TD><TD>    }</TD></TR><TR><TD CLASS="l">139</TD><TD> </TD></TR><TR><TD CLASS="l">140</TD><TD>    /**</TD></TR><TR><TD CLASS="l">141</TD><TD>     * Authorize method that grants custom permissions.</TD></TR><TR><TD CLASS="l">142</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">143</TD><TD>     * See authorize() below for @params.</TD></TR><TR><TD CLASS="l">144</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l"><A NAME="10">145</A></TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">146</TD><TD>     */</TD></TR><TR><TD CLASS="l">147</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">148</TD><TD>    public void authorize(Activity activity, String[] permissions, final DialogListener listener) {</TD></TR><TR CLASS="z"><TD CLASS="l">149</TD><TD>        authorize(activity, permissions, DEFAULT_AUTH_ACTIVITY_CODE, SessionLoginBehavior.SSO_WITH_FALLBACK, listener);</TD></TR><TR CLASS="z"><TD CLASS="l">150</TD><TD>    }</TD></TR><TR><TD CLASS="l">151</TD><TD> </TD></TR><TR><TD CLASS="l">152</TD><TD>    /**</TD></TR><TR><TD CLASS="l">153</TD><TD>     * Full authorize method.</TD></TR><TR><TD CLASS="l">154</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">155</TD><TD>     * Starts either an Activity or a dialog which prompts the user to log in to</TD></TR><TR><TD CLASS="l">156</TD><TD>     * Facebook and grant the requested permissions to the given application.</TD></TR><TR><TD CLASS="l">157</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">158</TD><TD>     * This method will, when possible, use Facebook's single sign-on for</TD></TR><TR><TD CLASS="l">159</TD><TD>     * Android to obtain an access token. This involves proxying a call through</TD></TR><TR><TD CLASS="l">160</TD><TD>     * the Facebook for Android stand-alone application, which will handle the</TD></TR><TR><TD CLASS="l">161</TD><TD>     * authentication flow, and return an OAuth access token for making API</TD></TR><TR><TD CLASS="l">162</TD><TD>     * calls.</TD></TR><TR><TD CLASS="l">163</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">164</TD><TD>     * Because this process will not be available for all users, if single</TD></TR><TR><TD CLASS="l">165</TD><TD>     * sign-on is not possible, this method will automatically fall back to the</TD></TR><TR><TD CLASS="l">166</TD><TD>     * OAuth 2.0 User-Agent flow. In this flow, the user credentials are handled</TD></TR><TR><TD CLASS="l">167</TD><TD>     * by Facebook in an embedded WebView, not by the client application. As</TD></TR><TR><TD CLASS="l">168</TD><TD>     * such, the dialog makes a network request and renders HTML content rather</TD></TR><TR><TD CLASS="l">169</TD><TD>     * than a native UI. The access token is retrieved from a redirect to a</TD></TR><TR><TD CLASS="l">170</TD><TD>     * special URL that the WebView handles.</TD></TR><TR><TD CLASS="l">171</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">172</TD><TD>     * Note that User credentials could be handled natively using the OAuth 2.0</TD></TR><TR><TD CLASS="l">173</TD><TD>     * Username and Password Flow, but this is not supported by this SDK.</TD></TR><TR><TD CLASS="l">174</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">175</TD><TD>     * See http://developers.facebook.com/docs/authentication/ and</TD></TR><TR><TD CLASS="l">176</TD><TD>     * http://wiki.oauth.net/OAuth-2 for more details.</TD></TR><TR><TD CLASS="l">177</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">178</TD><TD>     * Note that this method is asynchronous and the callback will be invoked in</TD></TR><TR><TD CLASS="l">179</TD><TD>     * the original calling thread (not in a background thread).</TD></TR><TR><TD CLASS="l">180</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">181</TD><TD>     * Also note that requests may be made to the API without calling authorize</TD></TR><TR><TD CLASS="l">182</TD><TD>     * first, in which case only public information is returned.</TD></TR><TR><TD CLASS="l">183</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">184</TD><TD>     * IMPORTANT: Note that single sign-on authentication will not function</TD></TR><TR><TD CLASS="l">185</TD><TD>     * correctly if you do not include a call to the authorizeCallback() method</TD></TR><TR><TD CLASS="l">186</TD><TD>     * in your onActivityResult() function! Please see below for more</TD></TR><TR><TD CLASS="l">187</TD><TD>     * information. single sign-on may be disabled by passing FORCE_DIALOG_AUTH</TD></TR><TR><TD CLASS="l">188</TD><TD>     * as the activityCode parameter in your call to authorize().</TD></TR><TR><TD CLASS="l">189</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">190</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">191</TD><TD>     *</TD></TR><TR><TD CLASS="l">192</TD><TD>     * @param activity</TD></TR><TR><TD CLASS="l">193</TD><TD>     *            The Android activity in which we want to display the</TD></TR><TR><TD CLASS="l">194</TD><TD>     *            authorization dialog.</TD></TR><TR><TD CLASS="l">195</TD><TD>     * @param permissions</TD></TR><TR><TD CLASS="l">196</TD><TD>     *            A list of permissions required for this application: e.g.</TD></TR><TR><TD CLASS="l">197</TD><TD>     *            &#34;read_stream&#34;, &#34;publish_stream&#34;, &#34;offline_access&#34;, etc. see</TD></TR><TR><TD CLASS="l">198</TD><TD>     *            http://developers.facebook.com/docs/authentication/permissions</TD></TR><TR><TD CLASS="l">199</TD><TD>     *            This parameter should not be null -- if you do not require any</TD></TR><TR><TD CLASS="l">200</TD><TD>     *            permissions, then pass in an empty String array.</TD></TR><TR><TD CLASS="l">201</TD><TD>     * @param activityCode</TD></TR><TR><TD CLASS="l">202</TD><TD>     *            Single sign-on requires an activity result to be called back</TD></TR><TR><TD CLASS="l">203</TD><TD>     *            to the client application -- if you are waiting on other</TD></TR><TR><TD CLASS="l">204</TD><TD>     *            activities to return data, pass a custom activity code here to</TD></TR><TR><TD CLASS="l">205</TD><TD>     *            avoid collisions. If you would like to force the use of legacy</TD></TR><TR><TD CLASS="l">206</TD><TD>     *            dialog-based authorization, pass FORCE_DIALOG_AUTH for this</TD></TR><TR><TD CLASS="l">207</TD><TD>     *            parameter. Otherwise just omit this parameter and Facebook</TD></TR><TR><TD CLASS="l">208</TD><TD>     *            will use a suitable default. See</TD></TR><TR><TD CLASS="l">209</TD><TD>     *            http://developer.android.com/reference/android/</TD></TR><TR><TD CLASS="l">210</TD><TD>     *            app/Activity.html for more information.</TD></TR><TR><TD CLASS="l">211</TD><TD>     * @param listener</TD></TR><TR><TD CLASS="l">212</TD><TD>     *            Callback interface for notifying the calling application when</TD></TR><TR><TD CLASS="l">213</TD><TD>     *            the authentication dialog has completed, failed, or been</TD></TR><TR><TD CLASS="l"><A NAME="11">214</A></TD><TD>     *            canceled.</TD></TR><TR><TD CLASS="l">215</TD><TD>     */</TD></TR><TR><TD CLASS="l">216</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">217</TD><TD>    public void authorize(Activity activity, String[] permissions, int activityCode, final DialogListener listener) {</TD></TR><TR CLASS="z"><TD CLASS="l">218</TD><TD>        SessionLoginBehavior behavior = (activityCode &gt;= 0) ? SessionLoginBehavior.SSO_WITH_FALLBACK</TD></TR><TR><TD CLASS="l">219</TD><TD>                : SessionLoginBehavior.SUPPRESS_SSO;</TD></TR><TR><TD CLASS="l">220</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">221</TD><TD>        authorize(activity, permissions, activityCode, behavior, listener);</TD></TR><TR CLASS="z"><TD CLASS="l">222</TD><TD>    }</TD></TR><TR><TD CLASS="l">223</TD><TD> </TD></TR><TR><TD CLASS="l">224</TD><TD>    /**</TD></TR><TR><TD CLASS="l">225</TD><TD>     * Full authorize method.</TD></TR><TR><TD CLASS="l">226</TD><TD>     * </TD></TR><TR><TD CLASS="l">227</TD><TD>     * Starts either an Activity or a dialog which prompts the user to log in to</TD></TR><TR><TD CLASS="l">228</TD><TD>     * Facebook and grant the requested permissions to the given application.</TD></TR><TR><TD CLASS="l">229</TD><TD>     * </TD></TR><TR><TD CLASS="l">230</TD><TD>     * This method will, when possible, use Facebook's single sign-on for</TD></TR><TR><TD CLASS="l">231</TD><TD>     * Android to obtain an access token. This involves proxying a call through</TD></TR><TR><TD CLASS="l">232</TD><TD>     * the Facebook for Android stand-alone application, which will handle the</TD></TR><TR><TD CLASS="l">233</TD><TD>     * authentication flow, and return an OAuth access token for making API</TD></TR><TR><TD CLASS="l">234</TD><TD>     * calls.</TD></TR><TR><TD CLASS="l">235</TD><TD>     * </TD></TR><TR><TD CLASS="l">236</TD><TD>     * Because this process will not be available for all users, if single</TD></TR><TR><TD CLASS="l">237</TD><TD>     * sign-on is not possible, this method will automatically fall back to the</TD></TR><TR><TD CLASS="l">238</TD><TD>     * OAuth 2.0 User-Agent flow. In this flow, the user credentials are handled</TD></TR><TR><TD CLASS="l">239</TD><TD>     * by Facebook in an embedded WebView, not by the client application. As</TD></TR><TR><TD CLASS="l">240</TD><TD>     * such, the dialog makes a network request and renders HTML content rather</TD></TR><TR><TD CLASS="l">241</TD><TD>     * than a native UI. The access token is retrieved from a redirect to a</TD></TR><TR><TD CLASS="l">242</TD><TD>     * special URL that the WebView handles.</TD></TR><TR><TD CLASS="l">243</TD><TD>     * </TD></TR><TR><TD CLASS="l">244</TD><TD>     * Note that User credentials could be handled natively using the OAuth 2.0</TD></TR><TR><TD CLASS="l">245</TD><TD>     * Username and Password Flow, but this is not supported by this SDK.</TD></TR><TR><TD CLASS="l">246</TD><TD>     * </TD></TR><TR><TD CLASS="l">247</TD><TD>     * See http://developers.facebook.com/docs/authentication/ and</TD></TR><TR><TD CLASS="l">248</TD><TD>     * http://wiki.oauth.net/OAuth-2 for more details.</TD></TR><TR><TD CLASS="l">249</TD><TD>     * </TD></TR><TR><TD CLASS="l">250</TD><TD>     * Note that this method is asynchronous and the callback will be invoked in</TD></TR><TR><TD CLASS="l">251</TD><TD>     * the original calling thread (not in a background thread).</TD></TR><TR><TD CLASS="l">252</TD><TD>     * </TD></TR><TR><TD CLASS="l">253</TD><TD>     * Also note that requests may be made to the API without calling authorize</TD></TR><TR><TD CLASS="l">254</TD><TD>     * first, in which case only public information is returned.</TD></TR><TR><TD CLASS="l">255</TD><TD>     * </TD></TR><TR><TD CLASS="l">256</TD><TD>     * IMPORTANT: Note that single sign-on authentication will not function</TD></TR><TR><TD CLASS="l">257</TD><TD>     * correctly if you do not include a call to the authorizeCallback() method</TD></TR><TR><TD CLASS="l">258</TD><TD>     * in your onActivityResult() function! Please see below for more</TD></TR><TR><TD CLASS="l">259</TD><TD>     * information. single sign-on may be disabled by passing FORCE_DIALOG_AUTH</TD></TR><TR><TD CLASS="l">260</TD><TD>     * as the activityCode parameter in your call to authorize().</TD></TR><TR><TD CLASS="l">261</TD><TD>     * </TD></TR><TR><TD CLASS="l">262</TD><TD>     * @param activity</TD></TR><TR><TD CLASS="l">263</TD><TD>     *            The Android activity in which we want to display the</TD></TR><TR><TD CLASS="l">264</TD><TD>     *            authorization dialog.</TD></TR><TR><TD CLASS="l">265</TD><TD>     * @param permissions</TD></TR><TR><TD CLASS="l">266</TD><TD>     *            A list of permissions required for this application: e.g.</TD></TR><TR><TD CLASS="l">267</TD><TD>     *            &#34;read_stream&#34;, &#34;publish_stream&#34;, &#34;offline_access&#34;, etc. see</TD></TR><TR><TD CLASS="l">268</TD><TD>     *            http://developers.facebook.com/docs/authentication/permissions</TD></TR><TR><TD CLASS="l">269</TD><TD>     *            This parameter should not be null -- if you do not require any</TD></TR><TR><TD CLASS="l">270</TD><TD>     *            permissions, then pass in an empty String array.</TD></TR><TR><TD CLASS="l">271</TD><TD>     * @param activityCode</TD></TR><TR><TD CLASS="l">272</TD><TD>     *            Single sign-on requires an activity result to be called back</TD></TR><TR><TD CLASS="l">273</TD><TD>     *            to the client application -- if you are waiting on other</TD></TR><TR><TD CLASS="l">274</TD><TD>     *            activities to return data, pass a custom activity code here to</TD></TR><TR><TD CLASS="l">275</TD><TD>     *            avoid collisions. If you would like to force the use of legacy</TD></TR><TR><TD CLASS="l">276</TD><TD>     *            dialog-based authorization, pass FORCE_DIALOG_AUTH for this</TD></TR><TR><TD CLASS="l">277</TD><TD>     *            parameter. Otherwise just omit this parameter and Facebook</TD></TR><TR><TD CLASS="l">278</TD><TD>     *            will use a suitable default. See</TD></TR><TR><TD CLASS="l">279</TD><TD>     *            http://developer.android.com/reference/android/</TD></TR><TR><TD CLASS="l">280</TD><TD>     *            app/Activity.html for more information.</TD></TR><TR><TD CLASS="l">281</TD><TD>     * @param behavior</TD></TR><TR><TD CLASS="l">282</TD><TD>     *            The {@link SessionLoginBehavior SessionLoginBehavior} that</TD></TR><TR><TD CLASS="l">283</TD><TD>     *            specifies what behaviors should be attempted during</TD></TR><TR><TD CLASS="l">284</TD><TD>     *            authorization.</TD></TR><TR><TD CLASS="l">285</TD><TD>     * @param listener</TD></TR><TR><TD CLASS="l">286</TD><TD>     *            Callback interface for notifying the calling application when</TD></TR><TR><TD CLASS="l">287</TD><TD>     *            the authentication dialog has completed, failed, or been</TD></TR><TR><TD CLASS="l"><A NAME="12">288</A></TD><TD>     *            canceled.</TD></TR><TR><TD CLASS="l">289</TD><TD>     */</TD></TR><TR><TD CLASS="l">290</TD><TD>    private void authorize(Activity activity, String[] permissions, int activityCode,</TD></TR><TR><TD CLASS="l">291</TD><TD>                          SessionLoginBehavior behavior, final DialogListener listener) {</TD></TR><TR CLASS="z"><TD CLASS="l">292</TD><TD>        checkUserSession(&#34;authorize&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">293</TD><TD>        pendingOpeningSession = new Session.Builder(activity).</TD></TR><TR><TD CLASS="l">294</TD><TD>                setApplicationId(mAppId).</TD></TR><TR><TD CLASS="l">295</TD><TD>                setTokenCachingStrategy(getTokenCache()).</TD></TR><TR><TD CLASS="l"><A NAME="38">296</A></TD><TD>                build();</TD></TR><TR CLASS="z"><TD CLASS="l">297</TD><TD>        pendingAuthorizationActivity = activity;</TD></TR><TR CLASS="z"><TD CLASS="l">298</TD><TD>        pendingAuthorizationPermissions = (permissions != null) ? permissions : new String[0];</TD></TR><TR><TD CLASS="l">299</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3a">300</A></TD><TD>        StatusCallback callback = new StatusCallback() {</TD></TR><TR><TD CLASS="l">301</TD><TD>            @Override</TD></TR><TR><TD CLASS="l">302</TD><TD>            public void call(Session callbackSession, SessionState state, Exception exception) {</TD></TR><TR><TD CLASS="l">303</TD><TD>                // Invoke user-callback.</TD></TR><TR CLASS="z"><TD CLASS="l">304</TD><TD>                onSessionCallback(callbackSession, state, exception, listener);</TD></TR><TR CLASS="z"><TD CLASS="l">305</TD><TD>            }</TD></TR><TR><TD CLASS="l">306</TD><TD>        };</TD></TR><TR><TD CLASS="l">307</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">308</TD><TD>        Session.OpenRequest openRequest = new Session.OpenRequest(activity).</TD></TR><TR><TD CLASS="l">309</TD><TD>                setCallback(callback).</TD></TR><TR><TD CLASS="l">310</TD><TD>                setLoginBehavior(behavior).</TD></TR><TR><TD CLASS="l">311</TD><TD>                setRequestCode(activityCode).</TD></TR><TR><TD CLASS="l">312</TD><TD>                setPermissions(Arrays.asList(pendingAuthorizationPermissions));</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="25">313</A></TD><TD>        openSession(pendingOpeningSession, openRequest, pendingAuthorizationPermissions.length &gt; 0);</TD></TR><TR CLASS="z"><TD CLASS="l">314</TD><TD>    }</TD></TR><TR><TD CLASS="l">315</TD><TD> </TD></TR><TR><TD CLASS="l">316</TD><TD>    private void openSession(Session session, Session.OpenRequest openRequest, boolean isPublish) {</TD></TR><TR CLASS="z"><TD CLASS="l">317</TD><TD>        openRequest.setIsLegacy(true);</TD></TR><TR CLASS="z"><TD CLASS="l">318</TD><TD>        if (isPublish) {</TD></TR><TR CLASS="z"><TD CLASS="l">319</TD><TD>            session.openForPublish(openRequest);</TD></TR><TR><TD CLASS="l">320</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">321</TD><TD>            session.openForRead(openRequest);</TD></TR><TR><TD CLASS="l">322</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">323</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="24">324</A></TD><TD> </TD></TR><TR><TD CLASS="l">325</TD><TD>    @SuppressWarnings(&#34;deprecation&#34;)</TD></TR><TR><TD CLASS="l">326</TD><TD>    private void onSessionCallback(Session callbackSession, SessionState state, Exception exception,</TD></TR><TR><TD CLASS="l">327</TD><TD>            DialogListener listener) {</TD></TR><TR CLASS="z"><TD CLASS="l">328</TD><TD>        Bundle extras = callbackSession.getAuthorizationBundle();</TD></TR><TR><TD CLASS="l">329</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">330</TD><TD>        if (state == SessionState.OPENED) {</TD></TR><TR CLASS="z"><TD CLASS="l">331</TD><TD>            Session sessionToClose = null;</TD></TR><TR><TD CLASS="l">332</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">333</TD><TD>            synchronized (Facebook.this.lock) {</TD></TR><TR CLASS="z"><TD CLASS="l">334</TD><TD>                if (callbackSession != Facebook.this.session) {</TD></TR><TR CLASS="z"><TD CLASS="l">335</TD><TD>                    sessionToClose = Facebook.this.session;</TD></TR><TR CLASS="z"><TD CLASS="l">336</TD><TD>                    Facebook.this.session = callbackSession;</TD></TR><TR CLASS="z"><TD CLASS="l">337</TD><TD>                    Facebook.this.sessionInvalidated = false;</TD></TR><TR><TD CLASS="l">338</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">339</TD><TD>            }</TD></TR><TR><TD CLASS="l">340</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">341</TD><TD>            if (sessionToClose != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">342</TD><TD>                sessionToClose.close();</TD></TR><TR><TD CLASS="l">343</TD><TD>            }</TD></TR><TR><TD CLASS="l">344</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">345</TD><TD>            listener.onComplete(extras);</TD></TR><TR CLASS="z"><TD CLASS="l">346</TD><TD>        } else if (exception != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">347</TD><TD>            if (exception instanceof FacebookOperationCanceledException) {</TD></TR><TR CLASS="z"><TD CLASS="l">348</TD><TD>                listener.onCancel();</TD></TR><TR CLASS="z"><TD CLASS="l">349</TD><TD>            } else if ((exception instanceof FacebookAuthorizationException) &amp;&amp; (extras != null)</TD></TR><TR><TD CLASS="l">350</TD><TD>                    &amp;&amp; extras.containsKey(Session.WEB_VIEW_ERROR_CODE_KEY)</TD></TR><TR><TD CLASS="l">351</TD><TD>                    &amp;&amp; extras.containsKey(Session.WEB_VIEW_FAILING_URL_KEY)) {</TD></TR><TR CLASS="z"><TD CLASS="l">352</TD><TD>                DialogError error = new DialogError(exception.getMessage(),</TD></TR><TR><TD CLASS="l">353</TD><TD>                        extras.getInt(Session.WEB_VIEW_ERROR_CODE_KEY),</TD></TR><TR><TD CLASS="l">354</TD><TD>                        extras.getString(Session.WEB_VIEW_FAILING_URL_KEY));</TD></TR><TR CLASS="z"><TD CLASS="l">355</TD><TD>                listener.onError(error);</TD></TR><TR CLASS="z"><TD CLASS="l">356</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">357</TD><TD>                FacebookError error = new FacebookError(exception.getMessage());</TD></TR><TR CLASS="z"><TD CLASS="l">358</TD><TD>                listener.onFacebookError(error);</TD></TR><TR><TD CLASS="l">359</TD><TD>            }</TD></TR><TR><TD CLASS="l">360</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">361</TD><TD>    }</TD></TR><TR><TD CLASS="l">362</TD><TD> </TD></TR><TR><TD CLASS="l">363</TD><TD>    /**</TD></TR><TR><TD CLASS="l">364</TD><TD>     * Helper to validate a service intent by resolving and checking the</TD></TR><TR><TD CLASS="l">365</TD><TD>     * provider's package signature.</TD></TR><TR><TD CLASS="l">366</TD><TD>     * </TD></TR><TR><TD CLASS="l">367</TD><TD>     * @param context</TD></TR><TR><TD CLASS="l">368</TD><TD>     * @param intent</TD></TR><TR><TD CLASS="l"><A NAME="37">369</A></TD><TD>     * @return true if the service intent resolution happens successfully and</TD></TR><TR><TD CLASS="l">370</TD><TD>     *         the signatures match.</TD></TR><TR><TD CLASS="l">371</TD><TD>     */</TD></TR><TR><TD CLASS="l">372</TD><TD>    private boolean validateServiceIntent(Context context, Intent intent) {</TD></TR><TR CLASS="z"><TD CLASS="l">373</TD><TD>        ResolveInfo resolveInfo = context.getPackageManager().resolveService(intent, 0);</TD></TR><TR CLASS="z"><TD CLASS="l">374</TD><TD>        if (resolveInfo == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">375</TD><TD>            return false;</TD></TR><TR><TD CLASS="l">376</TD><TD>        }</TD></TR><TR><TD CLASS="l">377</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">378</TD><TD>        return validateAppSignatureForPackage(context, resolveInfo.serviceInfo.packageName);</TD></TR><TR><TD CLASS="l">379</TD><TD>    }</TD></TR><TR><TD CLASS="l">380</TD><TD> </TD></TR><TR><TD CLASS="l">381</TD><TD>    /**</TD></TR><TR><TD CLASS="l">382</TD><TD>     * Query the signature for the application that would be invoked by the</TD></TR><TR><TD CLASS="l">383</TD><TD>     * given intent and verify that it matches the FB application's signature.</TD></TR><TR><TD CLASS="l">384</TD><TD>     * </TD></TR><TR><TD CLASS="l">385</TD><TD>     * @param context</TD></TR><TR><TD CLASS="l">386</TD><TD>     * @param packageName</TD></TR><TR><TD CLASS="l">387</TD><TD>     * @return true if the app's signature matches the expected signature.</TD></TR><TR><TD CLASS="l">388</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="36">389</A></TD><TD>    private boolean validateAppSignatureForPackage(Context context, String packageName) {</TD></TR><TR><TD CLASS="l">390</TD><TD> </TD></TR><TR><TD CLASS="l">391</TD><TD>        PackageInfo packageInfo;</TD></TR><TR><TD CLASS="l">392</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">393</TD><TD>            packageInfo = context.getPackageManager().getPackageInfo(packageName, PackageManager.GET_SIGNATURES);</TD></TR><TR CLASS="z"><TD CLASS="l">394</TD><TD>        } catch (NameNotFoundException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">395</TD><TD>            return false;</TD></TR><TR CLASS="z"><TD CLASS="l">396</TD><TD>        }</TD></TR><TR><TD CLASS="l">397</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">398</TD><TD>        for (Signature signature : packageInfo.signatures) {</TD></TR><TR CLASS="z"><TD CLASS="l">399</TD><TD>            if (signature.toCharsString().equals(FB_APP_SIGNATURE)) {</TD></TR><TR CLASS="z"><TD CLASS="l">400</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">401</TD><TD>            }</TD></TR><TR><TD CLASS="l">402</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">403</TD><TD>        return false;</TD></TR><TR><TD CLASS="l">404</TD><TD>    }</TD></TR><TR><TD CLASS="l">405</TD><TD> </TD></TR><TR><TD CLASS="l">406</TD><TD>    /**</TD></TR><TR><TD CLASS="l">407</TD><TD>     * IMPORTANT: If you are using the deprecated authorize() method,</TD></TR><TR><TD CLASS="l">408</TD><TD>     * this method must be invoked at the top of the calling</TD></TR><TR><TD CLASS="l">409</TD><TD>     * activity's onActivityResult() function or Facebook authentication will</TD></TR><TR><TD CLASS="l">410</TD><TD>     * not function properly!</TD></TR><TR><TD CLASS="l">411</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">412</TD><TD>     * If your calling activity does not currently implement onActivityResult(),</TD></TR><TR><TD CLASS="l">413</TD><TD>     * you must implement it and include a call to this method if you intend to</TD></TR><TR><TD CLASS="l">414</TD><TD>     * use the authorize() method in this SDK.</TD></TR><TR><TD CLASS="l">415</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">416</TD><TD>     * For more information, see</TD></TR><TR><TD CLASS="l">417</TD><TD>     * http://developer.android.com/reference/android/app/</TD></TR><TR><TD CLASS="l">418</TD><TD>     * Activity.html#onActivityResult(int, int, android.content.Intent)</TD></TR><TR><TD CLASS="l">419</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l"><A NAME="13">420</A></TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">421</TD><TD>     */</TD></TR><TR><TD CLASS="l">422</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">423</TD><TD>    public void authorizeCallback(int requestCode, int resultCode, Intent data) {</TD></TR><TR CLASS="z"><TD CLASS="l">424</TD><TD>        checkUserSession(&#34;authorizeCallback&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">425</TD><TD>        Session pending = this.pendingOpeningSession;</TD></TR><TR CLASS="z"><TD CLASS="l">426</TD><TD>        if (pending != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">427</TD><TD>            if (pending.onActivityResult(this.pendingAuthorizationActivity, requestCode, resultCode, data)) {</TD></TR><TR CLASS="z"><TD CLASS="l">428</TD><TD>                this.pendingOpeningSession = null;</TD></TR><TR CLASS="z"><TD CLASS="l">429</TD><TD>                this.pendingAuthorizationActivity = null;</TD></TR><TR CLASS="z"><TD CLASS="l">430</TD><TD>                this.pendingAuthorizationPermissions = null;</TD></TR><TR><TD CLASS="l">431</TD><TD>            }</TD></TR><TR><TD CLASS="l">432</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">433</TD><TD>    }</TD></TR><TR><TD CLASS="l">434</TD><TD> </TD></TR><TR><TD CLASS="l">435</TD><TD>    /**</TD></TR><TR><TD CLASS="l">436</TD><TD>     * Refresh OAuth access token method. Binds to Facebook for Android</TD></TR><TR><TD CLASS="l">437</TD><TD>     * stand-alone application application to refresh the access token. This</TD></TR><TR><TD CLASS="l">438</TD><TD>     * method tries to connect to the Facebook App which will handle the</TD></TR><TR><TD CLASS="l">439</TD><TD>     * authentication flow, and return a new OAuth access token. This method</TD></TR><TR><TD CLASS="l">440</TD><TD>     * will automatically replace the old token with a new one. Note that this</TD></TR><TR><TD CLASS="l">441</TD><TD>     * method is asynchronous and the callback will be invoked in the original</TD></TR><TR><TD CLASS="l">442</TD><TD>     * calling thread (not in a background thread).</TD></TR><TR><TD CLASS="l">443</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">444</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">445</TD><TD>     *</TD></TR><TR><TD CLASS="l">446</TD><TD>     * @param context</TD></TR><TR><TD CLASS="l">447</TD><TD>     *            The Android Context that will be used to bind to the Facebook</TD></TR><TR><TD CLASS="l">448</TD><TD>     *            RefreshToken Service</TD></TR><TR><TD CLASS="l">449</TD><TD>     * @param serviceListener</TD></TR><TR><TD CLASS="l">450</TD><TD>     *            Callback interface for notifying the calling application when</TD></TR><TR><TD CLASS="l">451</TD><TD>     *            the refresh request has completed or failed (can be null). In</TD></TR><TR><TD CLASS="l">452</TD><TD>     *            case of a success a new token can be found inside the result</TD></TR><TR><TD CLASS="l">453</TD><TD>     *            Bundle under Facebook.ACCESS_TOKEN key.</TD></TR><TR><TD CLASS="l"><A NAME="17">454</A></TD><TD>     * @return true if the binding to the RefreshToken Service was created</TD></TR><TR><TD CLASS="l">455</TD><TD>     */</TD></TR><TR><TD CLASS="l">456</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">457</TD><TD>    public boolean extendAccessToken(Context context, ServiceListener serviceListener) {</TD></TR><TR CLASS="z"><TD CLASS="l">458</TD><TD>        checkUserSession(&#34;extendAccessToken&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">459</TD><TD>        Intent intent = new Intent();</TD></TR><TR><TD CLASS="l">460</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">461</TD><TD>        intent.setClassName(&#34;com.facebook.katana&#34;, &#34;com.facebook.katana.platform.TokenRefreshService&#34;);</TD></TR><TR><TD CLASS="l">462</TD><TD> </TD></TR><TR><TD CLASS="l">463</TD><TD>        // Verify that the application whose package name is</TD></TR><TR><TD CLASS="l">464</TD><TD>        // com.facebook.katana</TD></TR><TR><TD CLASS="l">465</TD><TD>        // has the expected FB app signature.</TD></TR><TR CLASS="z"><TD CLASS="l">466</TD><TD>        if (!validateServiceIntent(context, intent)) {</TD></TR><TR CLASS="z"><TD CLASS="l">467</TD><TD>            return false;</TD></TR><TR><TD CLASS="l">468</TD><TD>        }</TD></TR><TR><TD CLASS="l">469</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">470</TD><TD>        return context.bindService(intent, new TokenRefreshServiceConnection(context, serviceListener),</TD></TR><TR><TD CLASS="l">471</TD><TD>                Context.BIND_AUTO_CREATE);</TD></TR><TR><TD CLASS="l">472</TD><TD>    }</TD></TR><TR><TD CLASS="l">473</TD><TD> </TD></TR><TR><TD CLASS="l">474</TD><TD>    /**</TD></TR><TR><TD CLASS="l">475</TD><TD>     * Calls extendAccessToken if shouldExtendAccessToken returns true.</TD></TR><TR><TD CLASS="l">476</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">477</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">478</TD><TD>     *</TD></TR><TR><TD CLASS="l">479</TD><TD>     * @return the same value as extendAccessToken if the the token requires</TD></TR><TR><TD CLASS="l"><A NAME="18">480</A></TD><TD>     *         refreshing, true otherwise</TD></TR><TR><TD CLASS="l">481</TD><TD>     */</TD></TR><TR><TD CLASS="l">482</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">483</TD><TD>    public boolean extendAccessTokenIfNeeded(Context context, ServiceListener serviceListener) {</TD></TR><TR CLASS="z"><TD CLASS="l">484</TD><TD>        checkUserSession(&#34;extendAccessTokenIfNeeded&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">485</TD><TD>        if (shouldExtendAccessToken()) {</TD></TR><TR CLASS="z"><TD CLASS="l">486</TD><TD>            return extendAccessToken(context, serviceListener);</TD></TR><TR><TD CLASS="l">487</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">488</TD><TD>        return true;</TD></TR><TR><TD CLASS="l">489</TD><TD>    }</TD></TR><TR><TD CLASS="l">490</TD><TD> </TD></TR><TR><TD CLASS="l">491</TD><TD>    /**</TD></TR><TR><TD CLASS="l">492</TD><TD>     * Check if the access token requires refreshing.</TD></TR><TR><TD CLASS="l">493</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">494</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">495</TD><TD>     *</TD></TR><TR><TD CLASS="l">496</TD><TD>     * @return true if the last time a new token was obtained was over 24 hours</TD></TR><TR><TD CLASS="l"><A NAME="33">497</A></TD><TD>     *         ago.</TD></TR><TR><TD CLASS="l">498</TD><TD>     */</TD></TR><TR><TD CLASS="l">499</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">500</TD><TD>    public boolean shouldExtendAccessToken() {</TD></TR><TR CLASS="z"><TD CLASS="l">501</TD><TD>        checkUserSession(&#34;shouldExtendAccessToken&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">502</TD><TD>        return isSessionValid()</TD></TR><TR><TD CLASS="l">503</TD><TD>                &amp;&amp; (System.currentTimeMillis() - lastAccessUpdateMillisecondsAfterEpoch &gt;= REFRESH_TOKEN_BARRIER);</TD></TR><TR><TD CLASS="l">504</TD><TD>    }</TD></TR><TR><TD CLASS="l">505</TD><TD> </TD></TR><TR><TD CLASS="l">506</TD><TD>    /**</TD></TR><TR><TD CLASS="l">507</TD><TD>     * Handles connection to the token refresh service (this service is a part</TD></TR><TR><TD CLASS="l">508</TD><TD>     * of Facebook App).</TD></TR><TR><TD CLASS="l">509</TD><TD>     */</TD></TR><TR><TD CLASS="l">510</TD><TD>    private class TokenRefreshServiceConnection implements ServiceConnection {</TD></TR><TR><TD CLASS="l">511</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">512</TD><TD>        final Messenger messageReceiver = new Messenger(</TD></TR><TR><TD CLASS="l">513</TD><TD>                new TokenRefreshConnectionHandler(Facebook.this, this));</TD></TR><TR><TD CLASS="l">514</TD><TD> </TD></TR><TR><TD CLASS="l">515</TD><TD>        final ServiceListener serviceListener;</TD></TR><TR><TD CLASS="l"><A NAME="44">516</A></TD><TD>        final Context applicationsContext;</TD></TR><TR><TD CLASS="l">517</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">518</TD><TD>        Messenger messageSender = null;</TD></TR><TR><TD CLASS="l">519</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">520</TD><TD>        public TokenRefreshServiceConnection(Context applicationsContext, ServiceListener serviceListener) {</TD></TR><TR CLASS="z"><TD CLASS="l">521</TD><TD>            this.applicationsContext = applicationsContext;</TD></TR><TR CLASS="z"><TD CLASS="l">522</TD><TD>            this.serviceListener = serviceListener;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="46">523</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">524</TD><TD> </TD></TR><TR><TD CLASS="l">525</TD><TD>        @Override</TD></TR><TR><TD CLASS="l">526</TD><TD>        public void onServiceConnected(ComponentName className, IBinder service) {</TD></TR><TR CLASS="z"><TD CLASS="l">527</TD><TD>            messageSender = new Messenger(service);</TD></TR><TR CLASS="z"><TD CLASS="l">528</TD><TD>            refreshToken();</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="47">529</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">530</TD><TD> </TD></TR><TR><TD CLASS="l">531</TD><TD>        @Override</TD></TR><TR><TD CLASS="l">532</TD><TD>        public void onServiceDisconnected(ComponentName arg) {</TD></TR><TR CLASS="z"><TD CLASS="l">533</TD><TD>            serviceListener.onError(new Error(&#34;Service disconnected&#34;));</TD></TR><TR><TD CLASS="l">534</TD><TD>            // We returned an error so there's no point in</TD></TR><TR><TD CLASS="l">535</TD><TD>            // keeping the binding open.</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="48">536</A></TD><TD>            applicationsContext.unbindService(TokenRefreshServiceConnection.this);</TD></TR><TR CLASS="z"><TD CLASS="l">537</TD><TD>        }</TD></TR><TR><TD CLASS="l">538</TD><TD> </TD></TR><TR><TD CLASS="l">539</TD><TD>        private void refreshToken() {</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>            Bundle requestData = new Bundle();</TD></TR><TR CLASS="z"><TD CLASS="l">541</TD><TD>            requestData.putString(TOKEN, accessToken);</TD></TR><TR><TD CLASS="l">542</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">543</TD><TD>            Message request = Message.obtain();</TD></TR><TR CLASS="z"><TD CLASS="l">544</TD><TD>            request.setData(requestData);</TD></TR><TR CLASS="z"><TD CLASS="l">545</TD><TD>            request.replyTo = messageReceiver;</TD></TR><TR><TD CLASS="l">546</TD><TD> </TD></TR><TR><TD CLASS="l">547</TD><TD>            try {</TD></TR><TR CLASS="z"><TD CLASS="l">548</TD><TD>                messageSender.send(request);</TD></TR><TR CLASS="z"><TD CLASS="l">549</TD><TD>            } catch (RemoteException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">550</TD><TD>                serviceListener.onError(new Error(&#34;Service connection error&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">551</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">552</TD><TD>        }</TD></TR><TR><TD CLASS="l">553</TD><TD>    }</TD></TR><TR><TD CLASS="l">554</TD><TD> </TD></TR><TR><TD CLASS="l">555</TD><TD>    // Creating a static Handler class to reduce the possibility of a memory leak.</TD></TR><TR><TD CLASS="l">556</TD><TD>    // Handler objects for the same thread all share a common Looper object, which they post messages</TD></TR><TR><TD CLASS="l">557</TD><TD>    // to and read from. As messages contain target Handler, as long as there are messages with target</TD></TR><TR><TD CLASS="l">558</TD><TD>    // handler in the message queue, the handler cannot be garbage collected. If handler is not static,</TD></TR><TR><TD CLASS="l">559</TD><TD>    // the instance of the containing class also cannot be garbage collected even if it is destroyed.</TD></TR><TR><TD CLASS="l">560</TD><TD>    private static class TokenRefreshConnectionHandler extends Handler {</TD></TR><TR><TD CLASS="l"><A NAME="41">561</A></TD><TD>        WeakReference&lt;Facebook&gt; facebookWeakReference;</TD></TR><TR><TD CLASS="l">562</TD><TD>        WeakReference&lt;TokenRefreshServiceConnection&gt; connectionWeakReference;</TD></TR><TR><TD CLASS="l">563</TD><TD> </TD></TR><TR><TD CLASS="l">564</TD><TD>        TokenRefreshConnectionHandler(Facebook facebook, TokenRefreshServiceConnection connection) {</TD></TR><TR CLASS="z"><TD CLASS="l">565</TD><TD>            super();</TD></TR><TR CLASS="z"><TD CLASS="l">566</TD><TD>            facebookWeakReference = new WeakReference&lt;Facebook&gt;(facebook);</TD></TR><TR CLASS="z"><TD CLASS="l">567</TD><TD>            connectionWeakReference = new WeakReference&lt;TokenRefreshServiceConnection&gt;(connection);</TD></TR><TR CLASS="z"><TD CLASS="l">568</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="43">569</A></TD><TD> </TD></TR><TR><TD CLASS="l">570</TD><TD>        @Override</TD></TR><TR><TD CLASS="l">571</TD><TD>        @SuppressWarnings(&#34;deprecation&#34;)</TD></TR><TR><TD CLASS="l">572</TD><TD>        public void handleMessage(Message msg) {</TD></TR><TR CLASS="z"><TD CLASS="l">573</TD><TD>            Facebook facebook = facebookWeakReference.get();</TD></TR><TR CLASS="z"><TD CLASS="l">574</TD><TD>            TokenRefreshServiceConnection connection = connectionWeakReference.get();</TD></TR><TR CLASS="z"><TD CLASS="l">575</TD><TD>            if (facebook == null || connection == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">576</TD><TD>                return;</TD></TR><TR><TD CLASS="l">577</TD><TD>            }</TD></TR><TR><TD CLASS="l">578</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">579</TD><TD>            String token = msg.getData().getString(TOKEN);</TD></TR><TR><TD CLASS="l">580</TD><TD>            // Legacy functions in Facebook class (and ServiceListener implementors) expect expires_in in</TD></TR><TR><TD CLASS="l">581</TD><TD>            // milliseconds from epoch</TD></TR><TR CLASS="z"><TD CLASS="l">582</TD><TD>            long expiresAtMsecFromEpoch = msg.getData().getLong(EXPIRES) * 1000L;</TD></TR><TR><TD CLASS="l">583</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">584</TD><TD>            if (token != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">585</TD><TD>                facebook.setAccessToken(token);</TD></TR><TR CLASS="z"><TD CLASS="l">586</TD><TD>                facebook.setAccessExpires(expiresAtMsecFromEpoch);</TD></TR><TR><TD CLASS="l">587</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">588</TD><TD>                Session refreshSession = facebook.session;</TD></TR><TR CLASS="z"><TD CLASS="l">589</TD><TD>                if (refreshSession != null) {</TD></TR><TR><TD CLASS="l">590</TD><TD>                    // Session.internalRefreshToken expects the original bundle with expires_in in seconds from</TD></TR><TR><TD CLASS="l">591</TD><TD>                    // epoch.</TD></TR><TR CLASS="z"><TD CLASS="l">592</TD><TD>                    LegacyHelper.extendTokenCompleted(refreshSession, msg.getData());</TD></TR><TR><TD CLASS="l">593</TD><TD>                }</TD></TR><TR><TD CLASS="l">594</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">595</TD><TD>                if (connection.serviceListener != null) {</TD></TR><TR><TD CLASS="l">596</TD><TD>                    // To avoid confusion we should return the expiration time in</TD></TR><TR><TD CLASS="l">597</TD><TD>                    // the same format as the getAccessExpires() function - that</TD></TR><TR><TD CLASS="l">598</TD><TD>                    // is in milliseconds.</TD></TR><TR CLASS="z"><TD CLASS="l">599</TD><TD>                    Bundle resultBundle = (Bundle) msg.getData().clone();</TD></TR><TR CLASS="z"><TD CLASS="l">600</TD><TD>                    resultBundle.putLong(EXPIRES, expiresAtMsecFromEpoch);</TD></TR><TR><TD CLASS="l">601</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">602</TD><TD>                    connection.serviceListener.onComplete(resultBundle);</TD></TR><TR><TD CLASS="l">603</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">604</TD><TD>            } else if (connection.serviceListener != null) { // extract errors only if</TD></TR><TR><TD CLASS="l">605</TD><TD>                // client wants them</TD></TR><TR CLASS="z"><TD CLASS="l">606</TD><TD>                String error = msg.getData().getString(&#34;error&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">607</TD><TD>                if (msg.getData().containsKey(&#34;error_code&#34;)) {</TD></TR><TR CLASS="z"><TD CLASS="l">608</TD><TD>                    int errorCode = msg.getData().getInt(&#34;error_code&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">609</TD><TD>                    connection.serviceListener.onFacebookError(new FacebookError(error, null, errorCode));</TD></TR><TR CLASS="z"><TD CLASS="l">610</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">611</TD><TD>                    connection.serviceListener.onError(new Error(error != null ? error : &#34;Unknown service error&#34;));</TD></TR><TR><TD CLASS="l">612</TD><TD>                }</TD></TR><TR><TD CLASS="l">613</TD><TD>            }</TD></TR><TR><TD CLASS="l">614</TD><TD> </TD></TR><TR><TD CLASS="l">615</TD><TD>            // The refreshToken function should be called rarely,</TD></TR><TR><TD CLASS="l">616</TD><TD>            // so there is no point in keeping the binding open.</TD></TR><TR CLASS="z"><TD CLASS="l">617</TD><TD>            connection.applicationsContext.unbindService(connection);</TD></TR><TR CLASS="z"><TD CLASS="l">618</TD><TD>        }</TD></TR><TR><TD CLASS="l">619</TD><TD>    }</TD></TR><TR><TD CLASS="l">620</TD><TD> </TD></TR><TR><TD CLASS="l">621</TD><TD>    /**</TD></TR><TR><TD CLASS="l">622</TD><TD>     * Invalidate the current user session by removing the access token in</TD></TR><TR><TD CLASS="l">623</TD><TD>     * memory, clearing the browser cookie, and calling auth.expireSession</TD></TR><TR><TD CLASS="l">624</TD><TD>     * through the API.</TD></TR><TR><TD CLASS="l">625</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">626</TD><TD>     * Note that this method blocks waiting for a network response, so do not</TD></TR><TR><TD CLASS="l">627</TD><TD>     * call it in a UI thread.</TD></TR><TR><TD CLASS="l">628</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">629</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">630</TD><TD>     *</TD></TR><TR><TD CLASS="l">631</TD><TD>     * @param context</TD></TR><TR><TD CLASS="l">632</TD><TD>     *            The Android context in which the logout should be called: it</TD></TR><TR><TD CLASS="l">633</TD><TD>     *            should be the same context in which the login occurred in</TD></TR><TR><TD CLASS="l">634</TD><TD>     *            order to clear any stored cookies</TD></TR><TR><TD CLASS="l">635</TD><TD>     * @throws IOException</TD></TR><TR><TD CLASS="l">636</TD><TD>     * @throws MalformedURLException</TD></TR><TR><TD CLASS="l">637</TD><TD>     * @return JSON string representation of the auth.expireSession response</TD></TR><TR><TD CLASS="l"><A NAME="22">638</A></TD><TD>     *         (&#34;true&#34; if successful)</TD></TR><TR><TD CLASS="l">639</TD><TD>     */</TD></TR><TR><TD CLASS="l">640</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">641</TD><TD>    public String logout(Context context) throws MalformedURLException, IOException {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="23">642</A></TD><TD>        return logoutImpl(context);</TD></TR><TR><TD CLASS="l">643</TD><TD>    }</TD></TR><TR><TD CLASS="l">644</TD><TD> </TD></TR><TR><TD CLASS="l">645</TD><TD>    String logoutImpl(Context context) throws MalformedURLException, IOException  {</TD></TR><TR CLASS="z"><TD CLASS="l">646</TD><TD>        checkUserSession(&#34;logout&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">647</TD><TD>        Bundle b = new Bundle();</TD></TR><TR CLASS="z"><TD CLASS="l">648</TD><TD>        b.putString(&#34;method&#34;, &#34;auth.expireSession&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">649</TD><TD>        String response = request(b);</TD></TR><TR><TD CLASS="l">650</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">651</TD><TD>        long currentTimeMillis = System.currentTimeMillis();</TD></TR><TR CLASS="z"><TD CLASS="l">652</TD><TD>        Session sessionToClose = null;</TD></TR><TR><TD CLASS="l">653</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">654</TD><TD>        synchronized (this.lock) {</TD></TR><TR CLASS="z"><TD CLASS="l">655</TD><TD>            sessionToClose = session;</TD></TR><TR><TD CLASS="l">656</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">657</TD><TD>            session = null;</TD></TR><TR CLASS="z"><TD CLASS="l">658</TD><TD>            accessToken = null;</TD></TR><TR CLASS="z"><TD CLASS="l">659</TD><TD>            accessExpiresMillisecondsAfterEpoch = 0;</TD></TR><TR CLASS="z"><TD CLASS="l">660</TD><TD>            lastAccessUpdateMillisecondsAfterEpoch = currentTimeMillis;</TD></TR><TR CLASS="z"><TD CLASS="l">661</TD><TD>            sessionInvalidated = false;</TD></TR><TR CLASS="z"><TD CLASS="l">662</TD><TD>        }</TD></TR><TR><TD CLASS="l">663</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">664</TD><TD>        if (sessionToClose != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">665</TD><TD>            sessionToClose.closeAndClearTokenInformation();</TD></TR><TR><TD CLASS="l">666</TD><TD>        }</TD></TR><TR><TD CLASS="l">667</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">668</TD><TD>        return response;</TD></TR><TR><TD CLASS="l">669</TD><TD>    }</TD></TR><TR><TD CLASS="l">670</TD><TD> </TD></TR><TR><TD CLASS="l">671</TD><TD>    /**</TD></TR><TR><TD CLASS="l">672</TD><TD>     * Make a request to Facebook's old (pre-graph) API with the given</TD></TR><TR><TD CLASS="l">673</TD><TD>     * parameters. One of the parameter keys must be &#34;method&#34; and its value</TD></TR><TR><TD CLASS="l">674</TD><TD>     * should be a valid REST server API method.</TD></TR><TR><TD CLASS="l">675</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">676</TD><TD>     * See http://developers.facebook.com/docs/reference/rest/</TD></TR><TR><TD CLASS="l">677</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">678</TD><TD>     * Note that this method blocks waiting for a network response, so do not</TD></TR><TR><TD CLASS="l">679</TD><TD>     * call it in a UI thread.</TD></TR><TR><TD CLASS="l">680</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">681</TD><TD>     * Example: &lt;code&gt;</TD></TR><TR><TD CLASS="l">682</TD><TD>     *  Bundle parameters = new Bundle();</TD></TR><TR><TD CLASS="l">683</TD><TD>     *  parameters.putString(&#34;method&#34;, &#34;auth.expireSession&#34;);</TD></TR><TR><TD CLASS="l">684</TD><TD>     *  String response = request(parameters);</TD></TR><TR><TD CLASS="l">685</TD><TD>     * &lt;/code&gt;</TD></TR><TR><TD CLASS="l">686</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">687</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Request} for more info.</TD></TR><TR><TD CLASS="l">688</TD><TD>     *</TD></TR><TR><TD CLASS="l">689</TD><TD>     * @param parameters</TD></TR><TR><TD CLASS="l">690</TD><TD>     *            Key-value pairs of parameters to the request. Refer to the</TD></TR><TR><TD CLASS="l">691</TD><TD>     *            documentation: one of the parameters must be &#34;method&#34;.</TD></TR><TR><TD CLASS="l">692</TD><TD>     * @throws IOException</TD></TR><TR><TD CLASS="l">693</TD><TD>     *             if a network error occurs</TD></TR><TR><TD CLASS="l">694</TD><TD>     * @throws MalformedURLException</TD></TR><TR><TD CLASS="l">695</TD><TD>     *             if accessing an invalid endpoint</TD></TR><TR><TD CLASS="l">696</TD><TD>     * @throws IllegalArgumentException</TD></TR><TR><TD CLASS="l">697</TD><TD>     *             if one of the parameters is not &#34;method&#34;</TD></TR><TR><TD CLASS="l"><A NAME="27">698</A></TD><TD>     * @return JSON string representation of the response</TD></TR><TR><TD CLASS="l">699</TD><TD>     */</TD></TR><TR><TD CLASS="l">700</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">701</TD><TD>    public String request(Bundle parameters) throws MalformedURLException, IOException {</TD></TR><TR CLASS="z"><TD CLASS="l">702</TD><TD>        if (!parameters.containsKey(&#34;method&#34;)) {</TD></TR><TR CLASS="z"><TD CLASS="l">703</TD><TD>            throw new IllegalArgumentException(&#34;API method must be specified. &#34;</TD></TR><TR><TD CLASS="l">704</TD><TD>                    + &#34;(parameters must contain key \&#34;method\&#34; and value). See&#34;</TD></TR><TR><TD CLASS="l">705</TD><TD>                    + &#34; http://developers.facebook.com/docs/reference/rest/&#34;);</TD></TR><TR><TD CLASS="l">706</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">707</TD><TD>        return requestImpl(null, parameters, &#34;GET&#34;);</TD></TR><TR><TD CLASS="l">708</TD><TD>    }</TD></TR><TR><TD CLASS="l">709</TD><TD> </TD></TR><TR><TD CLASS="l">710</TD><TD>    /**</TD></TR><TR><TD CLASS="l">711</TD><TD>     * Make a request to the Facebook Graph API without any parameters.</TD></TR><TR><TD CLASS="l">712</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">713</TD><TD>     * See http://developers.facebook.com/docs/api</TD></TR><TR><TD CLASS="l">714</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">715</TD><TD>     * Note that this method blocks waiting for a network response, so do not</TD></TR><TR><TD CLASS="l">716</TD><TD>     * call it in a UI thread.</TD></TR><TR><TD CLASS="l">717</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">718</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Request} for more info.</TD></TR><TR><TD CLASS="l">719</TD><TD>     *</TD></TR><TR><TD CLASS="l">720</TD><TD>     * @param graphPath</TD></TR><TR><TD CLASS="l">721</TD><TD>     *            Path to resource in the Facebook graph, e.g., to fetch data</TD></TR><TR><TD CLASS="l">722</TD><TD>     *            about the currently logged authenticated user, provide &#34;me&#34;,</TD></TR><TR><TD CLASS="l">723</TD><TD>     *            which will fetch http://graph.facebook.com/me</TD></TR><TR><TD CLASS="l">724</TD><TD>     * @throws IOException</TD></TR><TR><TD CLASS="l">725</TD><TD>     * @throws MalformedURLException</TD></TR><TR><TD CLASS="l"><A NAME="28">726</A></TD><TD>     * @return JSON string representation of the response</TD></TR><TR><TD CLASS="l">727</TD><TD>     */</TD></TR><TR><TD CLASS="l">728</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">729</TD><TD>    public String request(String graphPath) throws MalformedURLException, IOException {</TD></TR><TR CLASS="z"><TD CLASS="l">730</TD><TD>        return requestImpl(graphPath, new Bundle(), &#34;GET&#34;);</TD></TR><TR><TD CLASS="l">731</TD><TD>    }</TD></TR><TR><TD CLASS="l">732</TD><TD> </TD></TR><TR><TD CLASS="l">733</TD><TD>    /**</TD></TR><TR><TD CLASS="l">734</TD><TD>     * Make a request to the Facebook Graph API with the given string parameters</TD></TR><TR><TD CLASS="l">735</TD><TD>     * using an HTTP GET (default method).</TD></TR><TR><TD CLASS="l">736</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">737</TD><TD>     * See http://developers.facebook.com/docs/api</TD></TR><TR><TD CLASS="l">738</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">739</TD><TD>     * Note that this method blocks waiting for a network response, so do not</TD></TR><TR><TD CLASS="l">740</TD><TD>     * call it in a UI thread.</TD></TR><TR><TD CLASS="l">741</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">742</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Request} for more info.</TD></TR><TR><TD CLASS="l">743</TD><TD>     *</TD></TR><TR><TD CLASS="l">744</TD><TD>     * @param graphPath</TD></TR><TR><TD CLASS="l">745</TD><TD>     *            Path to resource in the Facebook graph, e.g., to fetch data</TD></TR><TR><TD CLASS="l">746</TD><TD>     *            about the currently logged authenticated user, provide &#34;me&#34;,</TD></TR><TR><TD CLASS="l">747</TD><TD>     *            which will fetch http://graph.facebook.com/me</TD></TR><TR><TD CLASS="l">748</TD><TD>     * @param parameters</TD></TR><TR><TD CLASS="l">749</TD><TD>     *            key-value string parameters, e.g. the path &#34;search&#34; with</TD></TR><TR><TD CLASS="l">750</TD><TD>     *            parameters &#34;q&#34; : &#34;facebook&#34; would produce a query for the</TD></TR><TR><TD CLASS="l">751</TD><TD>     *            following graph resource:</TD></TR><TR><TD CLASS="l">752</TD><TD>     *            https://graph.facebook.com/search?q=facebook</TD></TR><TR><TD CLASS="l">753</TD><TD>     * @throws IOException</TD></TR><TR><TD CLASS="l">754</TD><TD>     * @throws MalformedURLException</TD></TR><TR><TD CLASS="l"><A NAME="29">755</A></TD><TD>     * @return JSON string representation of the response</TD></TR><TR><TD CLASS="l">756</TD><TD>     */</TD></TR><TR><TD CLASS="l">757</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">758</TD><TD>    public String request(String graphPath, Bundle parameters) throws MalformedURLException, IOException {</TD></TR><TR CLASS="z"><TD CLASS="l">759</TD><TD>        return requestImpl(graphPath, parameters, &#34;GET&#34;);</TD></TR><TR><TD CLASS="l">760</TD><TD>    }</TD></TR><TR><TD CLASS="l">761</TD><TD> </TD></TR><TR><TD CLASS="l">762</TD><TD>    /**</TD></TR><TR><TD CLASS="l">763</TD><TD>     * Synchronously make a request to the Facebook Graph API with the given</TD></TR><TR><TD CLASS="l">764</TD><TD>     * HTTP method and string parameters. Note that binary data parameters (e.g.</TD></TR><TR><TD CLASS="l">765</TD><TD>     * pictures) are not yet supported by this helper function.</TD></TR><TR><TD CLASS="l">766</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">767</TD><TD>     * See http://developers.facebook.com/docs/api</TD></TR><TR><TD CLASS="l">768</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">769</TD><TD>     * Note that this method blocks waiting for a network response, so do not</TD></TR><TR><TD CLASS="l">770</TD><TD>     * call it in a UI thread.</TD></TR><TR><TD CLASS="l">771</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">772</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Request} for more info.</TD></TR><TR><TD CLASS="l">773</TD><TD>     *</TD></TR><TR><TD CLASS="l">774</TD><TD>     * @param graphPath</TD></TR><TR><TD CLASS="l">775</TD><TD>     *            Path to resource in the Facebook graph, e.g., to fetch data</TD></TR><TR><TD CLASS="l">776</TD><TD>     *            about the currently logged authenticated user, provide &#34;me&#34;,</TD></TR><TR><TD CLASS="l">777</TD><TD>     *            which will fetch http://graph.facebook.com/me</TD></TR><TR><TD CLASS="l">778</TD><TD>     * @param params</TD></TR><TR><TD CLASS="l">779</TD><TD>     *            Key-value string parameters, e.g. the path &#34;search&#34; with</TD></TR><TR><TD CLASS="l">780</TD><TD>     *            parameters {&#34;q&#34; : &#34;facebook&#34;} would produce a query for the</TD></TR><TR><TD CLASS="l">781</TD><TD>     *            following graph resource:</TD></TR><TR><TD CLASS="l">782</TD><TD>     *            https://graph.facebook.com/search?q=facebook</TD></TR><TR><TD CLASS="l">783</TD><TD>     * @param httpMethod</TD></TR><TR><TD CLASS="l">784</TD><TD>     *            http verb, e.g. &#34;GET&#34;, &#34;POST&#34;, &#34;DELETE&#34;</TD></TR><TR><TD CLASS="l">785</TD><TD>     * @throws IOException</TD></TR><TR><TD CLASS="l">786</TD><TD>     * @throws MalformedURLException</TD></TR><TR><TD CLASS="l">787</TD><TD>     * @return JSON string representation of the response</TD></TR><TR><TD CLASS="l"><A NAME="2a">788</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">789</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">790</TD><TD>    public String request(String graphPath, Bundle params, String httpMethod) throws FileNotFoundException,</TD></TR><TR><TD CLASS="l">791</TD><TD>            MalformedURLException, IOException {</TD></TR><TR CLASS="z"><TD CLASS="l">792</TD><TD>        return requestImpl(graphPath, params, httpMethod);</TD></TR><TR><TD CLASS="l">793</TD><TD>    }</TD></TR><TR><TD CLASS="l">794</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="2b">795</A></TD><TD>    // Internal call to avoid deprecated warnings.</TD></TR><TR><TD CLASS="l">796</TD><TD>    @SuppressWarnings(&#34;deprecation&#34;)</TD></TR><TR><TD CLASS="l">797</TD><TD>    String requestImpl(String graphPath, Bundle params, String httpMethod) throws FileNotFoundException,</TD></TR><TR><TD CLASS="l">798</TD><TD>            MalformedURLException, IOException {</TD></TR><TR CLASS="z"><TD CLASS="l">799</TD><TD>        params.putString(&#34;format&#34;, &#34;json&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">800</TD><TD>        if (isSessionValid()) {</TD></TR><TR CLASS="z"><TD CLASS="l">801</TD><TD>            params.putString(TOKEN, getAccessToken());</TD></TR><TR><TD CLASS="l">802</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">803</TD><TD>        String url = (graphPath != null) ? GRAPH_BASE_URL + graphPath : RESTSERVER_URL;</TD></TR><TR CLASS="z"><TD CLASS="l">804</TD><TD>        return Util.openUrl(url, httpMethod, params);</TD></TR><TR><TD CLASS="l">805</TD><TD>    }</TD></TR><TR><TD CLASS="l">806</TD><TD> </TD></TR><TR><TD CLASS="l">807</TD><TD>    /**</TD></TR><TR><TD CLASS="l">808</TD><TD>     * Generate a UI dialog for the request action in the given Android context.</TD></TR><TR><TD CLASS="l">809</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">810</TD><TD>     * Note that this method is asynchronous and the callback will be invoked in</TD></TR><TR><TD CLASS="l">811</TD><TD>     * the original calling thread (not in a background thread).</TD></TR><TR><TD CLASS="l">812</TD><TD>     *</TD></TR><TR><TD CLASS="l">813</TD><TD>     * This method is deprecated. See {@link com.facebook.widget.WebDialog}.</TD></TR><TR><TD CLASS="l">814</TD><TD>     *</TD></TR><TR><TD CLASS="l">815</TD><TD>     * @param context</TD></TR><TR><TD CLASS="l">816</TD><TD>     *            The Android context in which we will generate this dialog.</TD></TR><TR><TD CLASS="l">817</TD><TD>     * @param action</TD></TR><TR><TD CLASS="l">818</TD><TD>     *            String representation of the desired method: e.g. &#34;login&#34;,</TD></TR><TR><TD CLASS="l">819</TD><TD>     *            &#34;stream.publish&#34;, ...</TD></TR><TR><TD CLASS="l">820</TD><TD>     * @param listener</TD></TR><TR><TD CLASS="l">821</TD><TD>     *            Callback interface to notify the application when the dialog</TD></TR><TR><TD CLASS="l"><A NAME="16">822</A></TD><TD>     *            has completed.</TD></TR><TR><TD CLASS="l">823</TD><TD>     */</TD></TR><TR><TD CLASS="l">824</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">825</TD><TD>    public void dialog(Context context, String action, DialogListener listener) {</TD></TR><TR CLASS="z"><TD CLASS="l">826</TD><TD>        dialog(context, action, new Bundle(), listener);</TD></TR><TR CLASS="z"><TD CLASS="l">827</TD><TD>    }</TD></TR><TR><TD CLASS="l">828</TD><TD> </TD></TR><TR><TD CLASS="l">829</TD><TD>    /**</TD></TR><TR><TD CLASS="l">830</TD><TD>     * Generate a UI dialog for the request action in the given Android context</TD></TR><TR><TD CLASS="l">831</TD><TD>     * with the provided parameters.</TD></TR><TR><TD CLASS="l">832</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">833</TD><TD>     * Note that this method is asynchronous and the callback will be invoked in</TD></TR><TR><TD CLASS="l">834</TD><TD>     * the original calling thread (not in a background thread).</TD></TR><TR><TD CLASS="l">835</TD><TD>     *</TD></TR><TR><TD CLASS="l">836</TD><TD>     * This method is deprecated. See {@link com.facebook.widget.WebDialog}.</TD></TR><TR><TD CLASS="l">837</TD><TD>     * </TD></TR><TR><TD CLASS="l">838</TD><TD>     * @param context</TD></TR><TR><TD CLASS="l">839</TD><TD>     *            The Android context in which we will generate this dialog.</TD></TR><TR><TD CLASS="l">840</TD><TD>     * @param action</TD></TR><TR><TD CLASS="l">841</TD><TD>     *            String representation of the desired method: e.g. &#34;feed&#34; ...</TD></TR><TR><TD CLASS="l">842</TD><TD>     * @param parameters</TD></TR><TR><TD CLASS="l">843</TD><TD>     *            String key-value pairs to be passed as URL parameters.</TD></TR><TR><TD CLASS="l">844</TD><TD>     * @param listener</TD></TR><TR><TD CLASS="l">845</TD><TD>     *            Callback interface to notify the application when the dialog</TD></TR><TR><TD CLASS="l"><A NAME="15">846</A></TD><TD>     *            has completed.</TD></TR><TR><TD CLASS="l">847</TD><TD>     */</TD></TR><TR><TD CLASS="l">848</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">849</TD><TD>    public void dialog(Context context, String action, Bundle parameters, final DialogListener listener) {</TD></TR><TR CLASS="z"><TD CLASS="l">850</TD><TD>        parameters.putString(&#34;display&#34;, &#34;touch&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">851</TD><TD>        parameters.putString(&#34;redirect_uri&#34;, REDIRECT_URI);</TD></TR><TR><TD CLASS="l">852</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">853</TD><TD>        if (action.equals(LOGIN)) {</TD></TR><TR CLASS="z"><TD CLASS="l">854</TD><TD>            parameters.putString(&#34;type&#34;, &#34;user_agent&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">855</TD><TD>            parameters.putString(&#34;client_id&#34;, mAppId);</TD></TR><TR><TD CLASS="l">856</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">857</TD><TD>            parameters.putString(&#34;app_id&#34;, mAppId);</TD></TR><TR><TD CLASS="l">858</TD><TD>            // We do not want to add an access token when displaying the auth dialog.</TD></TR><TR CLASS="z"><TD CLASS="l">859</TD><TD>            if (isSessionValid()) {</TD></TR><TR CLASS="z"><TD CLASS="l">860</TD><TD>                parameters.putString(TOKEN, getAccessToken());</TD></TR><TR><TD CLASS="l">861</TD><TD>            }</TD></TR><TR><TD CLASS="l">862</TD><TD>        }</TD></TR><TR><TD CLASS="l">863</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">864</TD><TD>        if (context.checkCallingOrSelfPermission(Manifest.permission.INTERNET) != PackageManager.PERMISSION_GRANTED) {</TD></TR><TR CLASS="z"><TD CLASS="l">865</TD><TD>            Util.showAlert(context, &#34;Error&#34;, &#34;Application requires permission to access the Internet&#34;);</TD></TR><TR><TD CLASS="l">866</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">867</TD><TD>            new FbDialog(context, action, parameters, listener).show();</TD></TR><TR><TD CLASS="l">868</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">869</TD><TD>    }</TD></TR><TR><TD CLASS="l">870</TD><TD> </TD></TR><TR><TD CLASS="l">871</TD><TD>    /**</TD></TR><TR><TD CLASS="l">872</TD><TD>     * Returns whether the current access token is valid</TD></TR><TR><TD CLASS="l">873</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="21">874</A></TD><TD>     * @return boolean - whether this object has an non-expired session token</TD></TR><TR><TD CLASS="l">875</TD><TD>     */</TD></TR><TR><TD CLASS="l">876</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">877</TD><TD>    public boolean isSessionValid() {</TD></TR><TR CLASS="z"><TD CLASS="l">878</TD><TD>        return (getAccessToken() != null)</TD></TR><TR><TD CLASS="l">879</TD><TD>                &amp;&amp; ((getAccessExpires() == 0) || (System.currentTimeMillis() &lt; getAccessExpires()));</TD></TR><TR><TD CLASS="l">880</TD><TD>    }</TD></TR><TR><TD CLASS="l">881</TD><TD> </TD></TR><TR><TD CLASS="l">882</TD><TD>    /**</TD></TR><TR><TD CLASS="l">883</TD><TD>     * Allows the user to set a Session for the Facebook class to use.</TD></TR><TR><TD CLASS="l">884</TD><TD>     * If a Session is set here, then one should not use the authorize, logout,</TD></TR><TR><TD CLASS="l">885</TD><TD>     * or extendAccessToken methods which alter the Session object since that may</TD></TR><TR><TD CLASS="l">886</TD><TD>     * result in undefined behavior. Using those methods after setting the</TD></TR><TR><TD CLASS="l">887</TD><TD>     * session here will result in exceptions being thrown.</TD></TR><TR><TD CLASS="l">888</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="30">889</A></TD><TD>     * @param session the Session object to use, cannot be null</TD></TR><TR><TD CLASS="l">890</TD><TD>     */</TD></TR><TR><TD CLASS="l">891</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">892</TD><TD>    public void setSession(Session session) {</TD></TR><TR CLASS="z"><TD CLASS="l">893</TD><TD>        if (session == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">894</TD><TD>            throw new IllegalArgumentException(&#34;session cannot be null&#34;);</TD></TR><TR><TD CLASS="l">895</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">896</TD><TD>        synchronized (this.lock) {</TD></TR><TR CLASS="z"><TD CLASS="l">897</TD><TD>            this.userSetSession = session;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="14">898</A></TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">899</TD><TD>    }</TD></TR><TR><TD CLASS="l">900</TD><TD> </TD></TR><TR><TD CLASS="l">901</TD><TD>    private void checkUserSession(String methodName) {</TD></TR><TR CLASS="z"><TD CLASS="l">902</TD><TD>        if (userSetSession != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">903</TD><TD>            throw new UnsupportedOperationException(</TD></TR><TR><TD CLASS="l">904</TD><TD>                    String.format(&#34;Cannot call %s after setSession has been called.&#34;, methodName));</TD></TR><TR><TD CLASS="l">905</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">906</TD><TD>    }</TD></TR><TR><TD CLASS="l">907</TD><TD> </TD></TR><TR><TD CLASS="l">908</TD><TD>    /**</TD></TR><TR><TD CLASS="l">909</TD><TD>     * Get the underlying Session object to use with 3.0 api.</TD></TR><TR><TD CLASS="l">910</TD><TD>     * </TD></TR><TR><TD CLASS="l">911</TD><TD>     * @return Session - underlying session</TD></TR><TR><TD CLASS="l"><A NAME="1e">912</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">913</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">914</TD><TD>    public final Session getSession() {</TD></TR><TR><TD CLASS="l">915</TD><TD>        while (true) {</TD></TR><TR CLASS="z"><TD CLASS="l">916</TD><TD>            String cachedToken = null;</TD></TR><TR CLASS="z"><TD CLASS="l">917</TD><TD>            Session oldSession = null;</TD></TR><TR><TD CLASS="l">918</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">919</TD><TD>            synchronized (this.lock) {</TD></TR><TR CLASS="z"><TD CLASS="l">920</TD><TD>                if (userSetSession != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">921</TD><TD>                    return userSetSession;</TD></TR><TR><TD CLASS="l">922</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">923</TD><TD>                if ((session != null) || !sessionInvalidated) {</TD></TR><TR CLASS="z"><TD CLASS="l">924</TD><TD>                    return session;</TD></TR><TR><TD CLASS="l">925</TD><TD>                }</TD></TR><TR><TD CLASS="l">926</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">927</TD><TD>                cachedToken = accessToken;</TD></TR><TR CLASS="z"><TD CLASS="l">928</TD><TD>                oldSession = session;</TD></TR><TR CLASS="z"><TD CLASS="l">929</TD><TD>            }</TD></TR><TR><TD CLASS="l">930</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">931</TD><TD>            if (cachedToken == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">932</TD><TD>                return null;</TD></TR><TR><TD CLASS="l">933</TD><TD>            }</TD></TR><TR><TD CLASS="l">934</TD><TD> </TD></TR><TR><TD CLASS="l">935</TD><TD>            // At this point we do not have a valid session, but mAccessToken is</TD></TR><TR><TD CLASS="l">936</TD><TD>            // non-null.</TD></TR><TR><TD CLASS="l">937</TD><TD>            // So we can try building a session based on that.</TD></TR><TR><TD CLASS="l">938</TD><TD>            List&lt;String&gt; permissions;</TD></TR><TR CLASS="z"><TD CLASS="l">939</TD><TD>            if (oldSession != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">940</TD><TD>                permissions = oldSession.getPermissions();</TD></TR><TR CLASS="z"><TD CLASS="l">941</TD><TD>            } else if (pendingAuthorizationPermissions != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">942</TD><TD>                permissions = Arrays.asList(pendingAuthorizationPermissions);</TD></TR><TR><TD CLASS="l">943</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">944</TD><TD>                permissions = Collections.&lt;String&gt;emptyList();</TD></TR><TR><TD CLASS="l">945</TD><TD>            }</TD></TR><TR><TD CLASS="l">946</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">947</TD><TD>            Session newSession = new Session.Builder(pendingAuthorizationActivity).</TD></TR><TR><TD CLASS="l">948</TD><TD>                    setApplicationId(mAppId).</TD></TR><TR><TD CLASS="l">949</TD><TD>                    setTokenCachingStrategy(getTokenCache()).</TD></TR><TR><TD CLASS="l">950</TD><TD>                    build();</TD></TR><TR CLASS="z"><TD CLASS="l">951</TD><TD>            if (newSession.getState() != SessionState.CREATED_TOKEN_LOADED) {</TD></TR><TR CLASS="z"><TD CLASS="l">952</TD><TD>                return null;</TD></TR><TR><TD CLASS="l">953</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">954</TD><TD>            Session.OpenRequest openRequest =</TD></TR><TR><TD CLASS="l">955</TD><TD>                    new Session.OpenRequest(pendingAuthorizationActivity).setPermissions(permissions);</TD></TR><TR CLASS="z"><TD CLASS="l">956</TD><TD>            openSession(newSession, openRequest, !permissions.isEmpty());</TD></TR><TR><TD CLASS="l">957</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">958</TD><TD>            Session invalidatedSession = null;</TD></TR><TR CLASS="z"><TD CLASS="l">959</TD><TD>            Session returnSession = null;</TD></TR><TR><TD CLASS="l">960</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">961</TD><TD>            synchronized (this.lock) {</TD></TR><TR CLASS="z"><TD CLASS="l">962</TD><TD>                if (sessionInvalidated || (session == null)) {</TD></TR><TR CLASS="z"><TD CLASS="l">963</TD><TD>                    invalidatedSession = session;</TD></TR><TR CLASS="z"><TD CLASS="l">964</TD><TD>                    returnSession = session = newSession;</TD></TR><TR CLASS="z"><TD CLASS="l">965</TD><TD>                    sessionInvalidated = false;</TD></TR><TR><TD CLASS="l">966</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">967</TD><TD>            }</TD></TR><TR><TD CLASS="l">968</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">969</TD><TD>            if (invalidatedSession != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">970</TD><TD>                invalidatedSession.close();</TD></TR><TR><TD CLASS="l">971</TD><TD>            }</TD></TR><TR><TD CLASS="l">972</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">973</TD><TD>            if (returnSession != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">974</TD><TD>                return returnSession;</TD></TR><TR><TD CLASS="l">975</TD><TD>            }</TD></TR><TR><TD CLASS="l">976</TD><TD>            // Else token state changed between the synchronized blocks, so</TD></TR><TR><TD CLASS="l">977</TD><TD>            // retry..</TD></TR><TR CLASS="z"><TD CLASS="l">978</TD><TD>        }</TD></TR><TR><TD CLASS="l">979</TD><TD>    }</TD></TR><TR><TD CLASS="l">980</TD><TD> </TD></TR><TR><TD CLASS="l">981</TD><TD>    /**</TD></TR><TR><TD CLASS="l">982</TD><TD>     * Retrieve the OAuth 2.0 access token for API access: treat with care.</TD></TR><TR><TD CLASS="l">983</TD><TD>     * Returns null if no session exists.</TD></TR><TR><TD CLASS="l">984</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="1a">985</A></TD><TD>     * @return String - access token</TD></TR><TR><TD CLASS="l">986</TD><TD>     */</TD></TR><TR><TD CLASS="l">987</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">988</TD><TD>    public String getAccessToken() {</TD></TR><TR CLASS="z"><TD CLASS="l">989</TD><TD>        Session s = getSession();</TD></TR><TR CLASS="z"><TD CLASS="l">990</TD><TD>        if (s != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">991</TD><TD>            return s.getAccessToken();</TD></TR><TR><TD CLASS="l">992</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">993</TD><TD>            return null;</TD></TR><TR><TD CLASS="l">994</TD><TD>        }</TD></TR><TR><TD CLASS="l">995</TD><TD>    }</TD></TR><TR><TD CLASS="l">996</TD><TD> </TD></TR><TR><TD CLASS="l">997</TD><TD>    /**</TD></TR><TR><TD CLASS="l">998</TD><TD>     * Retrieve the current session's expiration time (in milliseconds since</TD></TR><TR><TD CLASS="l">999</TD><TD>     * Unix epoch), or 0 if the session doesn't expire or doesn't exist.</TD></TR><TR><TD CLASS="l">1000</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="19">1001</A></TD><TD>     * @return long - session expiration time</TD></TR><TR><TD CLASS="l">1002</TD><TD>     */</TD></TR><TR><TD CLASS="l">1003</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1004</TD><TD>    public long getAccessExpires() {</TD></TR><TR CLASS="z"><TD CLASS="l">1005</TD><TD>        Session s = getSession();</TD></TR><TR CLASS="z"><TD CLASS="l">1006</TD><TD>        if (s != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1007</TD><TD>            return s.getExpirationDate().getTime();</TD></TR><TR><TD CLASS="l">1008</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1009</TD><TD>            return accessExpiresMillisecondsAfterEpoch;</TD></TR><TR><TD CLASS="l">1010</TD><TD>        }</TD></TR><TR><TD CLASS="l">1011</TD><TD>    }</TD></TR><TR><TD CLASS="l">1012</TD><TD> </TD></TR><TR><TD CLASS="l">1013</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1014</TD><TD>     * Retrieve the last time the token was updated (in milliseconds since</TD></TR><TR><TD CLASS="l">1015</TD><TD>     * the Unix epoch), or 0 if the token has not been set.</TD></TR><TR><TD CLASS="l">1016</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="1d">1017</A></TD><TD>     * @return long - timestamp of the last token update.</TD></TR><TR><TD CLASS="l">1018</TD><TD>     */</TD></TR><TR><TD CLASS="l">1019</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1020</TD><TD>    public long getLastAccessUpdate() {</TD></TR><TR CLASS="z"><TD CLASS="l">1021</TD><TD>        return lastAccessUpdateMillisecondsAfterEpoch;</TD></TR><TR><TD CLASS="l">1022</TD><TD>    }</TD></TR><TR><TD CLASS="l">1023</TD><TD> </TD></TR><TR><TD CLASS="l">1024</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1025</TD><TD>     * Restore the token, expiration time, and last update time from cached values.</TD></TR><TR><TD CLASS="l">1026</TD><TD>     * These should be values obtained from getAccessToken(), getAccessExpires, and</TD></TR><TR><TD CLASS="l">1027</TD><TD>     * getLastAccessUpdate() respectively.</TD></TR><TR><TD CLASS="l">1028</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1029</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">1030</TD><TD>     *</TD></TR><TR><TD CLASS="l">1031</TD><TD>     * @param accessToken - access token</TD></TR><TR><TD CLASS="l">1032</TD><TD>     * @param accessExpires - access token expiration time</TD></TR><TR><TD CLASS="l"><A NAME="32">1033</A></TD><TD>     * @param lastAccessUpdate - timestamp of the last token update</TD></TR><TR><TD CLASS="l">1034</TD><TD>     */</TD></TR><TR><TD CLASS="l">1035</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1036</TD><TD>    public void setTokenFromCache(String accessToken, long accessExpires, long lastAccessUpdate) {</TD></TR><TR CLASS="z"><TD CLASS="l">1037</TD><TD>        checkUserSession(&#34;setTokenFromCache&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1038</TD><TD>        synchronized (this.lock) {</TD></TR><TR CLASS="z"><TD CLASS="l">1039</TD><TD>            this.accessToken = accessToken;</TD></TR><TR CLASS="z"><TD CLASS="l">1040</TD><TD>            accessExpiresMillisecondsAfterEpoch = accessExpires;</TD></TR><TR CLASS="z"><TD CLASS="l">1041</TD><TD>            lastAccessUpdateMillisecondsAfterEpoch = lastAccessUpdate;</TD></TR><TR CLASS="z"><TD CLASS="l">1042</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1043</TD><TD>    }</TD></TR><TR><TD CLASS="l">1044</TD><TD> </TD></TR><TR><TD CLASS="l">1045</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1046</TD><TD>     * Set the OAuth 2.0 access token for API access.</TD></TR><TR><TD CLASS="l">1047</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1048</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">1049</TD><TD>     *</TD></TR><TR><TD CLASS="l">1050</TD><TD>     * @param token</TD></TR><TR><TD CLASS="l"><A NAME="2e">1051</A></TD><TD>     *            - access token</TD></TR><TR><TD CLASS="l">1052</TD><TD>     */</TD></TR><TR><TD CLASS="l">1053</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1054</TD><TD>    public void setAccessToken(String token) {</TD></TR><TR CLASS="z"><TD CLASS="l">1055</TD><TD>        checkUserSession(&#34;setAccessToken&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1056</TD><TD>        synchronized (this.lock) {</TD></TR><TR CLASS="z"><TD CLASS="l">1057</TD><TD>            accessToken = token;</TD></TR><TR CLASS="z"><TD CLASS="l">1058</TD><TD>            lastAccessUpdateMillisecondsAfterEpoch = System.currentTimeMillis();</TD></TR><TR CLASS="z"><TD CLASS="l">1059</TD><TD>            sessionInvalidated = true;</TD></TR><TR CLASS="z"><TD CLASS="l">1060</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1061</TD><TD>    }</TD></TR><TR><TD CLASS="l">1062</TD><TD> </TD></TR><TR><TD CLASS="l">1063</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1064</TD><TD>     * Set the current session's expiration time (in milliseconds since Unix</TD></TR><TR><TD CLASS="l">1065</TD><TD>     * epoch), or 0 if the session doesn't expire.</TD></TR><TR><TD CLASS="l">1066</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1067</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">1068</TD><TD>     *</TD></TR><TR><TD CLASS="l">1069</TD><TD>     * @param timestampInMsec</TD></TR><TR><TD CLASS="l"><A NAME="2c">1070</A></TD><TD>     *            - timestamp in milliseconds</TD></TR><TR><TD CLASS="l">1071</TD><TD>     */</TD></TR><TR><TD CLASS="l">1072</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1073</TD><TD>    public void setAccessExpires(long timestampInMsec) {</TD></TR><TR CLASS="z"><TD CLASS="l">1074</TD><TD>        checkUserSession(&#34;setAccessExpires&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1075</TD><TD>        synchronized (this.lock) {</TD></TR><TR CLASS="z"><TD CLASS="l">1076</TD><TD>            accessExpiresMillisecondsAfterEpoch = timestampInMsec;</TD></TR><TR CLASS="z"><TD CLASS="l">1077</TD><TD>            lastAccessUpdateMillisecondsAfterEpoch = System.currentTimeMillis();</TD></TR><TR CLASS="z"><TD CLASS="l">1078</TD><TD>            sessionInvalidated = true;</TD></TR><TR CLASS="z"><TD CLASS="l">1079</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1080</TD><TD>    }</TD></TR><TR><TD CLASS="l">1081</TD><TD> </TD></TR><TR><TD CLASS="l">1082</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1083</TD><TD>     * Set the current session's duration (in seconds since Unix epoch), or &#34;0&#34;</TD></TR><TR><TD CLASS="l">1084</TD><TD>     * if session doesn't expire.</TD></TR><TR><TD CLASS="l">1085</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1086</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">1087</TD><TD>     *</TD></TR><TR><TD CLASS="l">1088</TD><TD>     * @param expiresInSecsFromNow</TD></TR><TR><TD CLASS="l"><A NAME="2d">1089</A></TD><TD>     *            - duration in seconds (or 0 if the session doesn't expire)</TD></TR><TR><TD CLASS="l">1090</TD><TD>     */</TD></TR><TR><TD CLASS="l">1091</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1092</TD><TD>    public void setAccessExpiresIn(String expiresInSecsFromNow) {</TD></TR><TR CLASS="z"><TD CLASS="l">1093</TD><TD>        checkUserSession(&#34;setAccessExpiresIn&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1094</TD><TD>        if (expiresInSecsFromNow != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1095</TD><TD>            long expires = expiresInSecsFromNow.equals(&#34;0&#34;) ? 0 : System.currentTimeMillis()</TD></TR><TR><TD CLASS="l">1096</TD><TD>                    + Long.parseLong(expiresInSecsFromNow) * 1000L;</TD></TR><TR CLASS="z"><TD CLASS="l">1097</TD><TD>            setAccessExpires(expires);</TD></TR><TR><TD CLASS="l">1098</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1099</TD><TD>    }</TD></TR><TR><TD CLASS="l">1100</TD><TD> </TD></TR><TR><TD CLASS="l">1101</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1102</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">1103</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="1b">1104</A></TD><TD>     * @return the String representing application ID</TD></TR><TR><TD CLASS="l">1105</TD><TD>     */</TD></TR><TR><TD CLASS="l">1106</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1107</TD><TD>    public String getAppId() {</TD></TR><TR CLASS="z"><TD CLASS="l">1108</TD><TD>        return mAppId;</TD></TR><TR><TD CLASS="l">1109</TD><TD>    }</TD></TR><TR><TD CLASS="l">1110</TD><TD> </TD></TR><TR><TD CLASS="l">1111</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1112</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Session} for more info.</TD></TR><TR><TD CLASS="l">1113</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="2f">1114</A></TD><TD>     * @param appId the String representing the application ID</TD></TR><TR><TD CLASS="l">1115</TD><TD>     */</TD></TR><TR><TD CLASS="l">1116</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1117</TD><TD>    public void setAppId(String appId) {</TD></TR><TR CLASS="z"><TD CLASS="l">1118</TD><TD>        checkUserSession(&#34;setAppId&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1119</TD><TD>        synchronized (this.lock) {</TD></TR><TR CLASS="z"><TD CLASS="l">1120</TD><TD>            mAppId = appId;</TD></TR><TR CLASS="z"><TD CLASS="l">1121</TD><TD>            sessionInvalidated = true;</TD></TR><TR CLASS="z"><TD CLASS="l">1122</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1123</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="20">1124</A></TD><TD> </TD></TR><TR><TD CLASS="l">1125</TD><TD>    private TokenCachingStrategy getTokenCache() {</TD></TR><TR><TD CLASS="l">1126</TD><TD>        // Intentionally not volatile/synchronized--it is okay if we race to</TD></TR><TR><TD CLASS="l">1127</TD><TD>        // create more than one of these.</TD></TR><TR CLASS="z"><TD CLASS="l">1128</TD><TD>        if (tokenCache == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1129</TD><TD>            tokenCache = new SetterTokenCachingStrategy();</TD></TR><TR><TD CLASS="l">1130</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="34">1131</A></TD><TD>        return tokenCache;</TD></TR><TR><TD CLASS="l">1132</TD><TD>    }</TD></TR><TR><TD CLASS="l">1133</TD><TD> </TD></TR><TR><TD CLASS="l">1134</TD><TD>    private static String[] stringArray(List&lt;String&gt; list) {</TD></TR><TR CLASS="z"><TD CLASS="l">1135</TD><TD>        int size = (list != null) ? list.size() : 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1136</TD><TD>        String[] array = new String[size];</TD></TR><TR><TD CLASS="l">1137</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1138</TD><TD>        if (list != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1139</TD><TD>            for (int i = 0; i &lt; array.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1140</TD><TD>                array[i] = list.get(i);</TD></TR><TR><TD CLASS="l">1141</TD><TD>            }</TD></TR><TR><TD CLASS="l">1142</TD><TD>        }</TD></TR><TR><TD CLASS="l">1143</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="35">1144</A></TD><TD>        return array;</TD></TR><TR><TD CLASS="l">1145</TD><TD>    }</TD></TR><TR><TD CLASS="l">1146</TD><TD> </TD></TR><TR><TD CLASS="l">1147</TD><TD>    private static List&lt;String&gt; stringList(String[] array) {</TD></TR><TR CLASS="z"><TD CLASS="l">1148</TD><TD>        if (array != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1149</TD><TD>            return Arrays.asList(array);</TD></TR><TR><TD CLASS="l">1150</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3b">1151</A></TD><TD>            return Collections.emptyList();</TD></TR><TR><TD CLASS="l">1152</TD><TD>        }</TD></TR><TR><TD CLASS="l">1153</TD><TD>    }</TD></TR><TR><TD CLASS="l">1154</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3f">1155</A></TD><TD>    private class SetterTokenCachingStrategy extends TokenCachingStrategy {</TD></TR><TR><TD CLASS="l">1156</TD><TD> </TD></TR><TR><TD CLASS="l">1157</TD><TD>        @Override</TD></TR><TR><TD CLASS="l">1158</TD><TD>        public Bundle load() {</TD></TR><TR CLASS="z"><TD CLASS="l">1159</TD><TD>            Bundle bundle = new Bundle();</TD></TR><TR><TD CLASS="l">1160</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1161</TD><TD>            if (accessToken != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1162</TD><TD>                TokenCachingStrategy.putToken(bundle, accessToken);</TD></TR><TR CLASS="z"><TD CLASS="l">1163</TD><TD>                TokenCachingStrategy.putExpirationMilliseconds(bundle, accessExpiresMillisecondsAfterEpoch);</TD></TR><TR CLASS="z"><TD CLASS="l">1164</TD><TD>                TokenCachingStrategy.putPermissions(bundle, stringList(pendingAuthorizationPermissions));</TD></TR><TR CLASS="z"><TD CLASS="l">1165</TD><TD>                TokenCachingStrategy.putSource(bundle, AccessTokenSource.WEB_VIEW);</TD></TR><TR CLASS="z"><TD CLASS="l">1166</TD><TD>                TokenCachingStrategy.putLastRefreshMilliseconds(bundle, lastAccessUpdateMillisecondsAfterEpoch);</TD></TR><TR><TD CLASS="l">1167</TD><TD>            }</TD></TR><TR><TD CLASS="l">1168</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1169</TD><TD>            return bundle;</TD></TR><TR><TD CLASS="l"><A NAME="40">1170</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1171</TD><TD> </TD></TR><TR><TD CLASS="l">1172</TD><TD>        @Override</TD></TR><TR><TD CLASS="l">1173</TD><TD>        public void save(Bundle bundle) {</TD></TR><TR CLASS="z"><TD CLASS="l">1174</TD><TD>            accessToken = TokenCachingStrategy.getToken(bundle);</TD></TR><TR CLASS="z"><TD CLASS="l">1175</TD><TD>            accessExpiresMillisecondsAfterEpoch = TokenCachingStrategy.getExpirationMilliseconds(bundle);</TD></TR><TR CLASS="z"><TD CLASS="l">1176</TD><TD>            pendingAuthorizationPermissions = stringArray(TokenCachingStrategy.getPermissions(bundle));</TD></TR><TR CLASS="z"><TD CLASS="l">1177</TD><TD>            lastAccessUpdateMillisecondsAfterEpoch = TokenCachingStrategy.getLastRefreshMilliseconds(bundle);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3e">1178</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1179</TD><TD> </TD></TR><TR><TD CLASS="l">1180</TD><TD>        @Override</TD></TR><TR><TD CLASS="l">1181</TD><TD>        public void clear() {</TD></TR><TR CLASS="z"><TD CLASS="l">1182</TD><TD>            accessToken = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1183</TD><TD>        }</TD></TR><TR><TD CLASS="l">1184</TD><TD>    }</TD></TR><TR><TD CLASS="l">1185</TD><TD> </TD></TR><TR><TD CLASS="l">1186</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1187</TD><TD>     * Get Attribution ID for app install conversion tracking.</TD></TR><TR><TD CLASS="l">1188</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1189</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Settings} for more info.</TD></TR><TR><TD CLASS="l">1190</TD><TD>     *</TD></TR><TR><TD CLASS="l">1191</TD><TD>     * @param contentResolver</TD></TR><TR><TD CLASS="l">1192</TD><TD>     * @return Attribution ID that will be used for conversion tracking. It will be null only if</TD></TR><TR><TD CLASS="l"><A NAME="1c">1193</A></TD><TD>     *         the user has not installed or logged in to the Facebook app.</TD></TR><TR><TD CLASS="l">1194</TD><TD>     */</TD></TR><TR><TD CLASS="l">1195</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1196</TD><TD>    public static String getAttributionId(ContentResolver contentResolver) {</TD></TR><TR CLASS="z"><TD CLASS="l">1197</TD><TD>        return Settings.getAttributionId(contentResolver);</TD></TR><TR><TD CLASS="l">1198</TD><TD>    }</TD></TR><TR><TD CLASS="l">1199</TD><TD> </TD></TR><TR><TD CLASS="l">1200</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1201</TD><TD>     * Get the auto install publish setting.  If true, an install event will be published during authorize(), unless</TD></TR><TR><TD CLASS="l">1202</TD><TD>     * it has occurred previously or the app does not have install attribution enabled on the application's developer</TD></TR><TR><TD CLASS="l">1203</TD><TD>     * config page.</TD></TR><TR><TD CLASS="l">1204</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1205</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Settings} for more info.</TD></TR><TR><TD CLASS="l">1206</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="1f">1207</A></TD><TD>     * @return a Boolean indicating whether installation of the app should be auto-published.</TD></TR><TR><TD CLASS="l">1208</TD><TD>     */</TD></TR><TR><TD CLASS="l">1209</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1210</TD><TD>    public boolean getShouldAutoPublishInstall() {</TD></TR><TR CLASS="z"><TD CLASS="l">1211</TD><TD>        return Settings.getShouldAutoPublishInstall();</TD></TR><TR><TD CLASS="l">1212</TD><TD>    }</TD></TR><TR><TD CLASS="l">1213</TD><TD> </TD></TR><TR><TD CLASS="l">1214</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1215</TD><TD>     * Sets whether auto publishing of installs will occur.</TD></TR><TR><TD CLASS="l">1216</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1217</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Settings} for more info.</TD></TR><TR><TD CLASS="l">1218</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="31">1219</A></TD><TD>     * @param value a Boolean indicating whether installation of the app should be auto-published.</TD></TR><TR><TD CLASS="l">1220</TD><TD>     */</TD></TR><TR><TD CLASS="l">1221</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1222</TD><TD>    public void setShouldAutoPublishInstall(boolean value) {</TD></TR><TR CLASS="z"><TD CLASS="l">1223</TD><TD>        Settings.setShouldAutoPublishInstall(value);</TD></TR><TR CLASS="z"><TD CLASS="l">1224</TD><TD>    }</TD></TR><TR><TD CLASS="l">1225</TD><TD> </TD></TR><TR><TD CLASS="l">1226</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1227</TD><TD>     * Manually publish install attribution to the Facebook graph.  Internally handles tracking repeat calls to prevent</TD></TR><TR><TD CLASS="l">1228</TD><TD>     * multiple installs being published to the graph.</TD></TR><TR><TD CLASS="l">1229</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1230</TD><TD>     * This method is deprecated.  See {@link Facebook} and {@link Settings} for more info.</TD></TR><TR><TD CLASS="l">1231</TD><TD>     *</TD></TR><TR><TD CLASS="l">1232</TD><TD>     * @param context the current Android context</TD></TR><TR><TD CLASS="l">1233</TD><TD>     * @return Always false.  Earlier versions of the API returned true if it was no longer necessary to call.</TD></TR><TR><TD CLASS="l">1234</TD><TD>     * Apps should ignore this value, but for compatibility we will return false to ensure repeat calls (and the</TD></TR><TR><TD CLASS="l"><A NAME="26">1235</A></TD><TD>     * underlying code will prevent duplicate network traffic).</TD></TR><TR><TD CLASS="l">1236</TD><TD>     */</TD></TR><TR><TD CLASS="l">1237</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1238</TD><TD>    public boolean publishInstall(final Context context) {</TD></TR><TR CLASS="z"><TD CLASS="l">1239</TD><TD>        Settings.publishInstallAsync(context, mAppId);</TD></TR><TR CLASS="z"><TD CLASS="l">1240</TD><TD>        return false;</TD></TR><TR><TD CLASS="l">1241</TD><TD>    }</TD></TR><TR><TD CLASS="l">1242</TD><TD> </TD></TR><TR><TD CLASS="l">1243</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1244</TD><TD>     * Callback interface for dialog requests.</TD></TR><TR><TD CLASS="l">1245</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1246</TD><TD>     * THIS CLASS SHOULD BE CONSIDERED DEPRECATED.</TD></TR><TR><TD CLASS="l">1247</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1248</TD><TD>     * All public members of this class are intentionally deprecated.</TD></TR><TR><TD CLASS="l">1249</TD><TD>     * New code should instead use</TD></TR><TR><TD CLASS="l">1250</TD><TD>     * {@link com.facebook.widget.WebDialog}</TD></TR><TR><TD CLASS="l">1251</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1252</TD><TD>     * Adding @Deprecated to this class causes warnings in other deprecated classes</TD></TR><TR><TD CLASS="l">1253</TD><TD>     * that reference this one.  That is the only reason this entire class is not</TD></TR><TR><TD CLASS="l">1254</TD><TD>     * deprecated.</TD></TR><TR><TD CLASS="l">1255</TD><TD>     *</TD></TR><TR><TD CLASS="l">1256</TD><TD>     * @devDocDeprecated</TD></TR><TR><TD CLASS="l">1257</TD><TD>     */</TD></TR><TR><TD CLASS="l">1258</TD><TD>    public static interface DialogListener {</TD></TR><TR><TD CLASS="l">1259</TD><TD> </TD></TR><TR><TD CLASS="l">1260</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1261</TD><TD>         * Called when a dialog completes.</TD></TR><TR><TD CLASS="l">1262</TD><TD>         * </TD></TR><TR><TD CLASS="l">1263</TD><TD>         * Executed by the thread that initiated the dialog.</TD></TR><TR><TD CLASS="l">1264</TD><TD>         * </TD></TR><TR><TD CLASS="l">1265</TD><TD>         * @param values</TD></TR><TR><TD CLASS="l">1266</TD><TD>         *            Key-value string pairs extracted from the response.</TD></TR><TR><TD CLASS="l">1267</TD><TD>         */</TD></TR><TR><TD CLASS="l">1268</TD><TD>        public void onComplete(Bundle values);</TD></TR><TR><TD CLASS="l">1269</TD><TD> </TD></TR><TR><TD CLASS="l">1270</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1271</TD><TD>         * Called when a Facebook responds to a dialog with an error.</TD></TR><TR><TD CLASS="l">1272</TD><TD>         * </TD></TR><TR><TD CLASS="l">1273</TD><TD>         * Executed by the thread that initiated the dialog.</TD></TR><TR><TD CLASS="l">1274</TD><TD>         * </TD></TR><TR><TD CLASS="l">1275</TD><TD>         */</TD></TR><TR><TD CLASS="l">1276</TD><TD>        public void onFacebookError(FacebookError e);</TD></TR><TR><TD CLASS="l">1277</TD><TD> </TD></TR><TR><TD CLASS="l">1278</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1279</TD><TD>         * Called when a dialog has an error.</TD></TR><TR><TD CLASS="l">1280</TD><TD>         * </TD></TR><TR><TD CLASS="l">1281</TD><TD>         * Executed by the thread that initiated the dialog.</TD></TR><TR><TD CLASS="l">1282</TD><TD>         * </TD></TR><TR><TD CLASS="l">1283</TD><TD>         */</TD></TR><TR><TD CLASS="l">1284</TD><TD>        public void onError(DialogError e);</TD></TR><TR><TD CLASS="l">1285</TD><TD> </TD></TR><TR><TD CLASS="l">1286</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1287</TD><TD>         * Called when a dialog is canceled by the user.</TD></TR><TR><TD CLASS="l">1288</TD><TD>         * </TD></TR><TR><TD CLASS="l">1289</TD><TD>         * Executed by the thread that initiated the dialog.</TD></TR><TR><TD CLASS="l">1290</TD><TD>         * </TD></TR><TR><TD CLASS="l">1291</TD><TD>         */</TD></TR><TR><TD CLASS="l">1292</TD><TD>        public void onCancel();</TD></TR><TR><TD CLASS="l">1293</TD><TD> </TD></TR><TR><TD CLASS="l">1294</TD><TD>    }</TD></TR><TR><TD CLASS="l">1295</TD><TD> </TD></TR><TR><TD CLASS="l">1296</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1297</TD><TD>     * Callback interface for service requests.</TD></TR><TR><TD CLASS="l">1298</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1299</TD><TD>     * THIS CLASS SHOULD BE CONSIDERED DEPRECATED.</TD></TR><TR><TD CLASS="l">1300</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1301</TD><TD>     * All public members of this class are intentionally deprecated.</TD></TR><TR><TD CLASS="l">1302</TD><TD>     * New code should instead use</TD></TR><TR><TD CLASS="l">1303</TD><TD>     * {@link Session} to manage session state.</TD></TR><TR><TD CLASS="l">1304</TD><TD>     * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">1305</TD><TD>     * Adding @Deprecated to this class causes warnings in other deprecated classes</TD></TR><TR><TD CLASS="l">1306</TD><TD>     * that reference this one.  That is the only reason this entire class is not</TD></TR><TR><TD CLASS="l">1307</TD><TD>     * deprecated.</TD></TR><TR><TD CLASS="l">1308</TD><TD>     *</TD></TR><TR><TD CLASS="l">1309</TD><TD>     * @devDocDeprecated</TD></TR><TR><TD CLASS="l">1310</TD><TD>     */</TD></TR><TR><TD CLASS="l">1311</TD><TD>    public static interface ServiceListener {</TD></TR><TR><TD CLASS="l">1312</TD><TD> </TD></TR><TR><TD CLASS="l">1313</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1314</TD><TD>         * Called when a service request completes.</TD></TR><TR><TD CLASS="l">1315</TD><TD>         * </TD></TR><TR><TD CLASS="l">1316</TD><TD>         * @param values</TD></TR><TR><TD CLASS="l">1317</TD><TD>         *            Key-value string pairs extracted from the response.</TD></TR><TR><TD CLASS="l">1318</TD><TD>         */</TD></TR><TR><TD CLASS="l">1319</TD><TD>        public void onComplete(Bundle values);</TD></TR><TR><TD CLASS="l">1320</TD><TD> </TD></TR><TR><TD CLASS="l">1321</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1322</TD><TD>         * Called when a Facebook server responds to the request with an error.</TD></TR><TR><TD CLASS="l">1323</TD><TD>         */</TD></TR><TR><TD CLASS="l">1324</TD><TD>        public void onFacebookError(FacebookError e);</TD></TR><TR><TD CLASS="l">1325</TD><TD> </TD></TR><TR><TD CLASS="l">1326</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1327</TD><TD>         * Called when a Facebook Service responds to the request with an error.</TD></TR><TR><TD CLASS="l">1328</TD><TD>         */</TD></TR><TR><TD CLASS="l">1329</TD><TD>        public void onError(Error e);</TD></TR><TR><TD CLASS="l">1330</TD><TD> </TD></TR><TR><TD CLASS="l">1331</TD><TD>    }</TD></TR><TR><TD CLASS="l">1332</TD><TD> </TD></TR><TR><TD CLASS="l">1333</TD><TD>    @Deprecated</TD></TR><TR><TD CLASS="l">1334</TD><TD>    public static final String FB_APP_SIGNATURE =</TD></TR><TR><TD CLASS="l">1335</TD><TD>        &#34;30820268308201d102044a9c4610300d06092a864886f70d0101040500307a310&#34;</TD></TR><TR><TD CLASS="l">1336</TD><TD>        + &#34;b3009060355040613025553310b30090603550408130243413112301006035504&#34;</TD></TR><TR><TD CLASS="l">1337</TD><TD>        + &#34;07130950616c6f20416c746f31183016060355040a130f46616365626f6f6b204&#34;</TD></TR><TR><TD CLASS="l">1338</TD><TD>        + &#34;d6f62696c653111300f060355040b130846616365626f6f6b311d301b06035504&#34;</TD></TR><TR><TD CLASS="l">1339</TD><TD>        + &#34;03131446616365626f6f6b20436f72706f726174696f6e3020170d30393038333&#34;</TD></TR><TR><TD CLASS="l">1340</TD><TD>        + &#34;13231353231365a180f32303530303932353231353231365a307a310b30090603&#34;</TD></TR><TR><TD CLASS="l">1341</TD><TD>        + &#34;55040613025553310b30090603550408130243413112301006035504071309506&#34;</TD></TR><TR><TD CLASS="l">1342</TD><TD>        + &#34;16c6f20416c746f31183016060355040a130f46616365626f6f6b204d6f62696c&#34;</TD></TR><TR><TD CLASS="l">1343</TD><TD>        + &#34;653111300f060355040b130846616365626f6f6b311d301b06035504031314466&#34;</TD></TR><TR><TD CLASS="l">1344</TD><TD>        + &#34;16365626f6f6b20436f72706f726174696f6e30819f300d06092a864886f70d01&#34;</TD></TR><TR><TD CLASS="l">1345</TD><TD>        + &#34;0101050003818d0030818902818100c207d51df8eb8c97d93ba0c8c1002c928fa&#34;</TD></TR><TR><TD CLASS="l">1346</TD><TD>        + &#34;b00dc1b42fca5e66e99cc3023ed2d214d822bc59e8e35ddcf5f44c7ae8ade50d7&#34;</TD></TR><TR><TD CLASS="l">1347</TD><TD>        + &#34;e0c434f500e6c131f4a2834f987fc46406115de2018ebbb0d5a3c261bd97581cc&#34;</TD></TR><TR><TD CLASS="l">1348</TD><TD>        + &#34;fef76afc7135a6d59e8855ecd7eacc8f8737e794c60a761c536b72b11fac8e603&#34;</TD></TR><TR><TD CLASS="l">1349</TD><TD>        + &#34;f5da1a2d54aa103b8a13c0dbc10203010001300d06092a864886f70d010104050&#34;</TD></TR><TR><TD CLASS="l">1350</TD><TD>        + &#34;0038181005ee9be8bcbb250648d3b741290a82a1c9dc2e76a0af2f2228f1d9f9c&#34;</TD></TR><TR><TD CLASS="l">1351</TD><TD>        + &#34;4007529c446a70175c5a900d5141812866db46be6559e2141616483998211f4a6&#34;</TD></TR><TR><TD CLASS="l">1352</TD><TD>        + &#34;73149fb2232a10d247663b26a9031e15f84bc1c74d141ff98a02d76f85b2c8ab2&#34;</TD></TR><TR><TD CLASS="l">1353</TD><TD>        + &#34;571b6469b232d8e768a7f7ca04f7abe4a775615916c07940656b58717457b42bd&#34;</TD></TR><TR><TD CLASS="l">1354</TD><TD>        + &#34;928a2&#34;;</TD></TR><TR><TD CLASS="l">1355</TD><TD> </TD></TR><TR><TD CLASS="l">1356</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../coverage.html">all classes</A>][<A HREF="1.html">com.facebook.android</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://sourceforge.net/projects/emma">EMMA 2.0.5312</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>